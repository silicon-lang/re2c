
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>User manual &#8212; re2c 1.2 documentation</title>
    <link rel="stylesheet" href="../_static/theme-re2c.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="alternate" type="application/atom+xml" href="../feed/atom.xml" title="Atom 1.0" />
    
 
  </head><body>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="re2c-logo">
    re2c
</div>

<h3><a href="../index.html">Home</a></h3>
<div class="re2c-toc-global">
    <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Build instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/changelog/changelog.html">Changelog</a></li>
</ul>

</div>
    <h3>User manual</h3>
    <div class="re2c-toc-local">
        <ul>
<li><a class="reference internal" href="#">User manual</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a><ul>
<li><a class="reference internal" href="#a-basic-example">A basic example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regular-expressions">Regular expressions</a></li>
<li><a class="reference internal" href="#user-interface">User interface</a><ul>
<li><a class="reference internal" href="#default-api">Default API</a></li>
<li><a class="reference internal" href="#generic-api">Generic API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#directives">Directives</a></li>
<li><a class="reference internal" href="#options">Options</a></li>
<li><a class="reference internal" href="#configurations">Configurations</a></li>
<li><a class="reference internal" href="#eof-handling">EOF handling</a><ul>
<li><a class="reference internal" href="#using-sentinel-symbol">Using sentinel symbol</a></li>
<li><a class="reference internal" href="#bounds-checking-with-padding">Bounds checking with padding</a></li>
<li><a class="reference internal" href="#eof-rule">EOF rule</a></li>
<li><a class="reference internal" href="#using-generic-api">Using generic API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buffer-refilling">Buffer refilling</a><ul>
<li><a class="reference internal" href="#yyfill-with-eof-rule">YYFILL with EOF rule</a></li>
<li><a class="reference internal" href="#yyfill-with-padding">YYFILL with padding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#include-files">Include files</a></li>
<li><a class="reference internal" href="#header-files">Header files</a></li>
<li><a class="reference internal" href="#submatch-extraction">Submatch extraction</a></li>
<li><a class="reference internal" href="#storable-state">Storable state</a></li>
<li><a class="reference internal" href="#reusable-blocks">Reusable blocks</a></li>
<li><a class="reference internal" href="#encoding-support">Encoding support</a></li>
<li><a class="reference internal" href="#start-conditions">Start conditions</a></li>
<li><a class="reference internal" href="#skeleton-programs">Skeleton programs</a></li>
<li><a class="reference internal" href="#visualization-and-debug">Visualization and debug</a></li>
<li><a class="reference internal" href="#warnings">Warnings</a><ul>
<li><a class="reference internal" href="#wundefined-control-flow">[-Wundefined-control-flow]</a><ul>
<li><a class="reference internal" href="#the-old-default-rule">The old default rule</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wunreachable-rules">[-Wunreachable-rules]</a></li>
<li><a class="reference internal" href="#wcondition-order">[-Wcondition-order]</a></li>
<li><a class="reference internal" href="#wuseless-escape">[-Wuseless-escape]</a></li>
<li><a class="reference internal" href="#wswapped-range">[-Wswapped-range]</a></li>
<li><a class="reference internal" href="#wempty-character-class">[-Wempty-character-class]</a></li>
<li><a class="reference internal" href="#wmatch-empty-string">[-Wmatch-empty-string]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-examples">More examples</a></li>
</ul>
</li>
</ul>

    </div>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="user-manual">
<h1>User manual<a class="headerlink" href="#user-manual" title="Permalink to this headline">¶</a></h1>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>A re2c program consists of a number of re2c blocks and directives intermixed
with normal C/C++ code. Each re2c block consists of a sequence of named
definitions, configurations and rules that contain regular expressions. The
generated lexer communicates with the outer world by the means of user
interface.
Rules consist of a regular expression followed by a user-defined action
(semantic action): a block of C/C++ code that is executed in case of sucessful
match. Semantic action can be either an arbitrary block of code enclosed in
curly braces <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code>, or a block of code without curly braces preceded
with <code class="docutils literal notranslate"><span class="pre">:=</span></code> and ended with a newline that is not followed by a whitespace.
If multiple rules match, longest match takes precedence. If multiple rules match
the same string, the earlier rule takes priority. If <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">--conditions</span></code> option
is used, then rules have more complex form described in the section about
conditions.  There are two special kinds of rules:</p>
<ul class="simple">
<li>Default rule <code class="docutils literal notranslate"><span class="pre">*</span></code> which has the lowest priority reagrdless of its place in
the source code, matches any code unit and consumes exactly one code unit.
This rule should always be defined.</li>
<li>EOF rule <code class="docutils literal notranslate"><span class="pre">$</span></code> which matches the end of input. This rule should be defined if
the simplified EOF handling method is used.</li>
</ul>
<p>Named definitions are of the form <code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">regexp</span> <span class="pre">;</span></code> where <code class="docutils literal notranslate"><span class="pre">name</span></code> is an
identifier that consists of letters, digits and underscores, and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> is a
regular expression. With <code class="docutils literal notranslate"><span class="pre">-F</span> <span class="pre">--flex-syntax</span></code> option named definitions are also
of the form <code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">regexp</span></code>. Each name should be defined before it is used.</p>
<div class="section" id="a-basic-example">
<h3>A basic example<a class="headerlink" href="#a-basic-example" title="Permalink to this headline">¶</a></h3>
<p>Here is an example program <a class="reference download internal" href="../_downloads/syntax.re" download=""><code class="xref download docutils literal notranslate"><span class="pre">[syntax.re]</span></code></a>
that shows various aspects of re2c syntax:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!re2c re2c:flags:i = 1; */</span>         <span class="c1">// re2c block with configuration that turns off #line directives</span>
                                     <span class="c1">//</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;                   //    C/C++ code</span><span class="cp"></span>
                                     <span class="c1">//</span>
<span class="cm">/*!max:re2c*/</span>                        <span class="c1">// directive that defines YYMAXFILL (unused)</span>
<span class="cm">/*!re2c                              // start of re2c block</span>
<span class="cm">    digit  = [0-9];                  //   named definition of &#39;digit&#39;</span>
<span class="cm">    number = digit+;                 //   named definition of &#39;number&#39;</span>
<span class="cm">*/</span>                                   <span class="c1">// end of re2c block</span>
                                     <span class="c1">//</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span> <span class="c1">// YYCURSOR is defined as a function parameter</span>
<span class="p">{</span>                                    <span class="c1">//</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>            <span class="c1">// YYMARKER is defined as a local variable</span>
    <span class="cm">/*!re2c                          // start of re2c block</span>
<span class="cm">    re2c:define:YYCTYPE = char;      //   configuration that defines YYCTYPE</span>
<span class="cm">    re2c:yyfill:enable  = 0;         //   configuration that turns off YYFILL</span>
<span class="cm">                                     //</span>
<span class="cm">    * { return 1; }                  //   default rule with its semantic action</span>
<span class="cm">                                     //</span>
<span class="cm">    number {                         //   a normal rule with its semantic action</span>
<span class="cm">        printf(&quot;number\n&quot;);          //     ... semantic action (continued)</span>
<span class="cm">        return 0;                    //     ... semantic action (continued)</span>
<span class="cm">    }                                //   end of semantic action</span>
<span class="cm">                                     //</span>
<span class="cm">    */</span>                               <span class="c1">// end of re2c block</span>
<span class="p">}</span>                                    <span class="c1">//</span>
                                     <span class="c1">//</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>                           <span class="c1">//</span>
<span class="p">{</span>                                    <span class="c1">//</span>
    <span class="n">lex</span><span class="p">(</span><span class="s">&quot;1024&quot;</span><span class="p">);</span>                     <span class="c1">//    C/C++ code</span>
    <span class="n">lex</span><span class="p">(</span><span class="s">&quot;;]&quot;</span><span class="p">);</span>                       <span class="c1">//</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>                        <span class="c1">//</span>
<span class="p">}</span>                                    <span class="c1">//</span>
</pre></div>
</div>
<p>Run re2c as <code class="docutils literal notranslate"><span class="pre">re2c</span> <span class="pre">-W</span> <span class="pre">syntax.re</span> <span class="pre">-o</span> <span class="pre">syntax.c</span></code> (option <code class="docutils literal notranslate"><span class="pre">-W</span></code> enables warnings).
The generated code <a class="reference download internal" href="../_downloads/syntax.c.txt" download=""><code class="xref download docutils literal notranslate"><span class="pre">[syntax.c]</span></code></a>
looks like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>                                     <span class="c1">// re2c block with configuration that turns off #line directives</span>
                                     <span class="c1">//</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;                   //    C/C++ code</span><span class="cp"></span>
                                     <span class="c1">//</span>
<span class="cp">#define YYMAXFILL 1                  </span><span class="c1">// directive that defines YYMAXFILL (unused)</span>
                                     <span class="c1">// end of re2c block</span>
                                     <span class="c1">//</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span> <span class="c1">// YYCURSOR is defined as a function parameter</span>
<span class="p">{</span>                                    <span class="c1">//</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>            <span class="c1">// YYMARKER is defined as a local variable</span>
    
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">yych</span><span class="p">;</span>
    <span class="n">yych</span> <span class="o">=</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">yych</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="sc">&#39;0&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;1&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;2&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;3&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;4&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;5&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;6&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;7&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;8&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;9&#39;</span><span class="o">:</span>   <span class="k">goto</span> <span class="n">yy4</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>    <span class="k">goto</span> <span class="n">yy2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">yy2</span><span class="p">:</span>
    <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
    <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="nl">yy4</span><span class="p">:</span>
    <span class="n">yych</span> <span class="o">=</span> <span class="o">*++</span><span class="n">YYCURSOR</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">yych</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="sc">&#39;0&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;1&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;2&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;3&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;4&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;5&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;6&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;7&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;8&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="sc">&#39;9&#39;</span><span class="o">:</span>   <span class="k">goto</span> <span class="n">yy4</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>    <span class="k">goto</span> <span class="n">yy6</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">yy6</span><span class="p">:</span>
    <span class="p">{</span>                                <span class="c1">//   a normal rule with its semantic action</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;number</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>          <span class="c1">//     ... semantic action (continued)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>                    <span class="c1">//     ... semantic action (continued)</span>
    <span class="p">}</span>
<span class="p">}</span>
                                     <span class="c1">// end of re2c block</span>
<span class="p">}</span>                                    <span class="c1">//</span>
                                     <span class="c1">//</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>                           <span class="c1">//</span>
<span class="p">{</span>                                    <span class="c1">//</span>
    <span class="n">lex</span><span class="p">(</span><span class="s">&quot;1024&quot;</span><span class="p">);</span>                     <span class="c1">//    C/C++ code</span>
    <span class="n">lex</span><span class="p">(</span><span class="s">&quot;;]&quot;</span><span class="p">);</span>                       <span class="c1">//</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>                        <span class="c1">//</span>
<span class="p">}</span>                                    <span class="c1">//</span>
</pre></div>
</div>
<p>The lines without comments correspond to the code generated by re2c. Not all
comments are present in the output — only those which are in C/C++ code, and
not inside of re2c blocks.</p>
</div>
</div>
<div class="section" id="regular-expressions">
<h2>Regular expressions<a class="headerlink" href="#regular-expressions" title="Permalink to this headline">¶</a></h2>
<p>re2c uses the following syntax for regular expressions:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> case-sensitive string literal</li>
<li><code class="docutils literal notranslate"><span class="pre">'foo'</span></code> case-insensitive string literal</li>
<li><code class="docutils literal notranslate"><span class="pre">[a-xyz]</span></code>, <code class="docutils literal notranslate"><span class="pre">[^a-xyz]</span></code> character class (possibly negated)</li>
<li><code class="docutils literal notranslate"><span class="pre">.</span></code> any character except newline</li>
<li><code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">\</span> <span class="pre">S</span></code> difference of character classes <code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">S</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">R*</span></code> zero or more occurrences of <code class="docutils literal notranslate"><span class="pre">R</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">R+</span></code> one or more occurrences of <code class="docutils literal notranslate"><span class="pre">R</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">R?</span></code> optional <code class="docutils literal notranslate"><span class="pre">R</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">R{n}</span></code> repetition of <code class="docutils literal notranslate"><span class="pre">R</span></code> exactly <code class="docutils literal notranslate"><span class="pre">n</span></code> times</li>
<li><code class="docutils literal notranslate"><span class="pre">R{n,}</span></code> repetition of <code class="docutils literal notranslate"><span class="pre">R</span></code> at least <code class="docutils literal notranslate"><span class="pre">n</span></code> times</li>
<li><code class="docutils literal notranslate"><span class="pre">R{n,m}</span></code> repetition of <code class="docutils literal notranslate"><span class="pre">R</span></code> from <code class="docutils literal notranslate"><span class="pre">n</span></code> to <code class="docutils literal notranslate"><span class="pre">m</span></code> times</li>
<li><code class="docutils literal notranslate"><span class="pre">(R)</span></code> just <code class="docutils literal notranslate"><span class="pre">R</span></code>; parentheses are used to override precedence or for POSIX-style submatch</li>
<li><code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">S</span></code> concatenation: <code class="docutils literal notranslate"><span class="pre">R</span></code> followed by <code class="docutils literal notranslate"><span class="pre">S</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">|</span> <span class="pre">S</span></code> alternative: <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">or</span> <span class="pre">S</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">/</span> <span class="pre">S</span></code> lookahead: <code class="docutils literal notranslate"><span class="pre">R</span></code> followed by <code class="docutils literal notranslate"><span class="pre">S</span></code>, but <code class="docutils literal notranslate"><span class="pre">S</span></code> is not consumed</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> the regular expression defined as <code class="docutils literal notranslate"><span class="pre">name</span></code> (or literal string <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code> in Flex compatibility mode)</li>
<li><code class="docutils literal notranslate"><span class="pre">{name}</span></code> the regular expression defined as <code class="docutils literal notranslate"><span class="pre">name</span></code> in Flex compatibility mode</li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;stag</span></code> an <em>s-tag</em>: saves the last input position at which <code class="docutils literal notranslate"><span class="pre">&#64;stag</span></code> matches in a variable named <code class="docutils literal notranslate"><span class="pre">stag</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">#mtag</span></code> an <em>m-tag</em>: saves all input positions at which <code class="docutils literal notranslate"><span class="pre">#mtag</span></code> matches in a variable named <code class="docutils literal notranslate"><span class="pre">mtag</span></code></li>
</ul>
<p>Character classes and string literals may contain the following escape sequences:
<code class="docutils literal notranslate"><span class="pre">\a</span></code>, <code class="docutils literal notranslate"><span class="pre">\b</span></code>, <code class="docutils literal notranslate"><span class="pre">\f</span></code>, <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">\r</span></code>, <code class="docutils literal notranslate"><span class="pre">\t</span></code>, <code class="docutils literal notranslate"><span class="pre">\v</span></code>, <code class="docutils literal notranslate"><span class="pre">\\</span></code>, octal escapes <code class="docutils literal notranslate"><span class="pre">\ooo</span></code> and hexadecimal escapes <code class="docutils literal notranslate"><span class="pre">\xhh</span></code>, <code class="docutils literal notranslate"><span class="pre">\uhhhh</span></code> and <code class="docutils literal notranslate"><span class="pre">\Uhhhhhhhh</span></code>.</p>
</div>
<div class="section" id="user-interface">
<h2>User interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h2>
<p>Below is the list of all symbols which may be used by the lexer in order to interact with the outer world.
These symbols should be defined by the user,
either in the form of inplace configurations,
or as C/C++ variables, functions, macros and other language constructs.
Which primitives are necessary depends on the particular use case.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">yyaccept</span></code></dt>
<dd>L-value of unsigned integral type that is used to hold the number of the last matched rule.
Explicit definition by the user is necessary only with <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYBACKUP</span> <span class="pre">()</span></code></dt>
<dd>Backup current input position (used only with <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYBACKUPCTX</span> <span class="pre">()</span></code></dt>
<dd>Backup current input position for trailing context (used only with  <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">yych</span></code></dt>
<dd>L-value of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> that is used to hold current input character.
Explicit definition by the user is necessary only with <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYCONDTYPE</span></code></dt>
<dd>The type of <em>condition</em> identifiers (used only with <code class="docutils literal notranslate"><span class="pre">-c</span></code> <code class="docutils literal notranslate"><span class="pre">--conditions</span></code> option).
Should be generated either with <code class="docutils literal notranslate"><span class="pre">/*!types:re2c*/</span></code> directive, or with <code class="docutils literal notranslate"><span class="pre">-t</span></code> <code class="docutils literal notranslate"><span class="pre">--type-header</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYCTXMARKER</span></code></dt>
<dd>L-value of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span> <span class="pre">*</span></code> that is used to backup input position of trailing context.
It is needed only if regular expressions use the lookahead operator <code class="docutils literal notranslate"><span class="pre">/</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code></dt>
<dd>The type of the input characters (<em>code units</em>).
Usually it should be <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code> for ASCII, EBCDIC and UTF-8 encodings,
<code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">short</span></code> for UTF-16 or UCS-2 encodings,
and <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code> for UTF-32 encoding.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code></dt>
<dd>L-value of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span> <span class="pre">*</span></code> that is used as a pointer to the current input symbol.
Initially <code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code> points to the first character and is advanced by the lexer during matching.
When a rule matches, <code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code> points past the last character of the matched string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYDEBUG</span> <span class="pre">(state,</span> <span class="pre">symbol)</span></code></dt>
<dd>A function-like primitive that is used to dump debug information (only used with <code class="docutils literal notranslate"><span class="pre">-d</span></code> <code class="docutils literal notranslate"><span class="pre">--debug-output</span></code> option).
<code class="docutils literal notranslate"><span class="pre">YYDEBUG</span></code> should return no value and accept two arguments:
<code class="docutils literal notranslate"><span class="pre">state</span></code> (either lexer state or <code class="docutils literal notranslate"><span class="pre">-1</span></code>) and <code class="docutils literal notranslate"><span class="pre">symbol</span></code> (current input symbol).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYFILL</span> <span class="pre">(n)</span></code></dt>
<dd>A function-like primitive that is called by the lexer when there is not enough input.
<code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> should return no value and supply at least <code class="docutils literal notranslate"><span class="pre">n</span></code> additional characters.
Maximal value of <code class="docutils literal notranslate"><span class="pre">n</span></code> equals <code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code>, which can be obtained with the <code class="docutils literal notranslate"><span class="pre">/*!max:re2c*/</span></code> directive.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYGETCONDITION</span> <span class="pre">()</span></code></dt>
<dd>R-value of type <code class="docutils literal notranslate"><span class="pre">YYCONDTYPE</span></code> that represents current <em>condition</em> identifier (used only with <code class="docutils literal notranslate"><span class="pre">-c</span></code> <code class="docutils literal notranslate"><span class="pre">--conditions</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span> <span class="pre">()</span></code></dt>
<dd>R-value of signed integral type that represents current lexer state (used only with <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> option).
Initial value of lexer state should be <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYLESSTHAN</span> <span class="pre">(n)</span></code></dt>
<dd>R-value of boolean type that is <code class="docutils literal notranslate"><span class="pre">true</span></code> if and only if there is less than <code class="docutils literal notranslate"><span class="pre">n</span></code> input characters left (used only with  <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code></dt>
<dd>R-value of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span> <span class="pre">*</span></code> that marks the end of input (<code class="docutils literal notranslate"><span class="pre">YYLIMIT[-1]</span></code> should be the last input character).
Lexer compares <code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code> and <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code> in order to determine if there is enough input characters left.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYMARKER</span></code></dt>
<dd>L-value of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span> <span class="pre">*</span></code> used to backup input position of successful match.
This might be necessary if there is an overlapping longer rule that might also match.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYMTAGP</span> <span class="pre">(t)</span></code></dt>
<dd>Append current input position to the history of <em>m-tag</em> <code class="docutils literal notranslate"><span class="pre">t</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">-T</span></code> <code class="docutils literal notranslate"><span class="pre">--tags</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYMTAGN</span> <span class="pre">(t)</span></code></dt>
<dd>Append default value to the history of <em>m-tag</em> <code class="docutils literal notranslate"><span class="pre">t</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">-T</span></code> <code class="docutils literal notranslate"><span class="pre">--tags</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code></dt>
<dd>Integral constant that denotes maximal value of <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> argument
and is autogenerated by <code class="docutils literal notranslate"><span class="pre">/*!max:re2c*/</span></code> directive.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYMAXNMATCH</span></code></dt>
<dd>Integral constant that denotes maximal number of capturing groups in a rule
and is autogenerated by <code class="docutils literal notranslate"><span class="pre">/*!maxnmatch:re2c*/</span></code> directive (used only with <code class="docutils literal notranslate"><span class="pre">--posix-captures</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">yynmatch</span></code></dt>
<dd>L-value of unsigned integral type that is used to hold the number of capturing groups in the matching rule.
Used only with <code class="docutils literal notranslate"><span class="pre">-P</span></code> <code class="docutils literal notranslate"><span class="pre">--posix-captures</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYPEEK</span> <span class="pre">()</span></code></dt>
<dd>R-value of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> that denotes current input character (used only with <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">yypmatch</span></code></dt>
<dd>An array of l-values that are used to hold the values of <em>s-tags</em>
corresponding to the capturing parentheses in the matching rule.
The length of array must be at least <code class="docutils literal notranslate"><span class="pre">yynmatch</span> <span class="pre">*</span> <span class="pre">2</span></code> (ideally <code class="docutils literal notranslate"><span class="pre">YYMAXNMATCH</span> <span class="pre">*</span> <span class="pre">2</span></code>).
Used only with <code class="docutils literal notranslate"><span class="pre">-P</span></code> <code class="docutils literal notranslate"><span class="pre">--posix-captures</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYRESTORE</span> <span class="pre">()</span></code></dt>
<dd>Restore input position (used only with <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYRESTORECTX</span> <span class="pre">()</span></code></dt>
<dd>Restore input position from the value of trailing context (used only with <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYRESTORETAG</span> <span class="pre">(t)</span></code></dt>
<dd>Restore input position from the value of <em>s-tag</em> <code class="docutils literal notranslate"><span class="pre">t</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span> <span class="pre">(condition)</span></code></dt>
<dd>Set current <em>condition</em> identifier to <code class="docutils literal notranslate"><span class="pre">condition</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">-c</span></code> <code class="docutils literal notranslate"><span class="pre">--conditions</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYSETSTATE</span> <span class="pre">(state)</span></code></dt>
<dd>Set current lexer state to <code class="docutils literal notranslate"><span class="pre">state</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> option).
Parameter <code class="docutils literal notranslate"><span class="pre">state</span></code> is of signed integral type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYSKIP</span> <span class="pre">()</span></code></dt>
<dd>Advance input position to the next character (used only with generic API).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYSTAGP</span> <span class="pre">(t)</span></code></dt>
<dd>Save current input position to <em>s-tag</em> <code class="docutils literal notranslate"><span class="pre">t</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">-T</span></code> <code class="docutils literal notranslate"><span class="pre">--tags</span></code> and <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YYSTAGN</span> <span class="pre">(t)</span></code></dt>
<dd>Save default value to <em>s-tag</em> <code class="docutils literal notranslate"><span class="pre">t</span></code> (used only with <code class="docutils literal notranslate"><span class="pre">-T</span></code> <code class="docutils literal notranslate"><span class="pre">--tags</span></code> and <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> options).</dd>
</dl>
<div class="section" id="default-api">
<h3>Default API<a class="headerlink" href="#default-api" title="Permalink to this headline">¶</a></h3>
<p>By default <code class="docutils literal notranslate"><span class="pre">re2c</span></code> operates on input using pointer-like primitives
<code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code>, <code class="docutils literal notranslate"><span class="pre">YYMARKER</span></code>, <code class="docutils literal notranslate"><span class="pre">YYCTXMARKER</span></code>, and <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code>.
Normally pointer-like primitives are defined as variables of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE*</span></code>,
but it is possible to use STL iterators or any other abstraction as long as it syntactically fits into the following use cases:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">++YYCURSOR;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">yych</span> <span class="pre">=</span> <span class="pre">*YYCURSOR;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">yych</span> <span class="pre">=</span> <span class="pre">*++YYCURSOR;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">yych</span> <span class="pre">=</span> <span class="pre">*(YYMARKER</span> <span class="pre">=</span> <span class="pre">YYCURSOR);</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">yych</span> <span class="pre">=</span> <span class="pre">*(YYMARKER</span> <span class="pre">=</span> <span class="pre">++YCURSOR);</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYMARKER</span> <span class="pre">=</span> <span class="pre">YYCURSOR;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYMARKER</span> <span class="pre">=</span> <span class="pre">++YYCURSOR;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYCURSOR</span> <span class="pre">=</span> <span class="pre">YYMARKER;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYCTXMARKER</span> <span class="pre">=</span> <span class="pre">YYCURSOR</span> <span class="pre">+</span> <span class="pre">1;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYCURSOR</span> <span class="pre">=</span> <span class="pre">YYCTXMARKER;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(YYLIMIT</span> <span class="pre">&lt;=</span> <span class="pre">YYCURSOR)</span> <span class="pre">...</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">((YYLIMIT</span> <span class="pre">-</span> <span class="pre">YYCURSOR)</span> <span class="pre">&lt;</span> <span class="pre">n)</span> <span class="pre">...</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYDEBUG</span> <span class="pre">(label,</span> <span class="pre">*YYCURSOR);</span></code></li>
</ul>
</div>
<div class="section" id="generic-api">
<h3>Generic API<a class="headerlink" href="#generic-api" title="Permalink to this headline">¶</a></h3>
<p>If the default input model is too restrictive, then it is possible to use generic input API enabled with <code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">custom</span></code> option.
In this mode all input operations are expressed in terms of the primitives below.
These primitives can be defined in any suitable way; one doesn’t have to stick to the pointer semantics.
For example, it is possible to read input directly from file without any buffering,
or to disable <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> mechanism and perform end-of-input checking on each input character from inside of <code class="docutils literal notranslate"><span class="pre">YYPEEK</span></code> or <code class="docutils literal notranslate"><span class="pre">YYSKIP</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">YYPEEK</span> <span class="pre">()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYSKIP</span> <span class="pre">()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYBACKUP</span> <span class="pre">()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYBACKUPCTX</span> <span class="pre">()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYSTAGP</span> <span class="pre">(t)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYSTAGN</span> <span class="pre">(t)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYMTAGP</span> <span class="pre">(t)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYMTAGN</span> <span class="pre">(t)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYRESTORE</span> <span class="pre">()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYRESTORECTX</span> <span class="pre">()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYRESTORETAG</span> <span class="pre">(t)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">YYLESSTHAN</span> <span class="pre">(n)</span></code></li>
</ul>
<p>Default input model can be expressed in terms of generic API as follows
(except for <code class="docutils literal notranslate"><span class="pre">YMTAGP</span></code> and <code class="docutils literal notranslate"><span class="pre">YYMTAGN</span></code>, which have no default implementation):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define  YYPEEK ()         *YYCURSOR</span>
<span class="cp">#define  YYSKIP ()         ++YYCURSOR</span>
<span class="cp">#define  YYBACKUP ()       YYMARKER = YYCURSOR</span>
<span class="cp">#define  YYBACKUPCTX ()    YYCTXMARKER = YYCURSOR</span>
<span class="cp">#define  YYRESTORE ()      YYCURSOR = YYMARKER</span>
<span class="cp">#define  YYRESTORECTX ()   YYCURSOR = YYCTXMARKER</span>
<span class="cp">#define  YYRESTORERAG (t)  YYCURSOR = t</span>
<span class="cp">#define  YYLESSTHAN (n)    YYLIMIT - YYCURSOR &lt; n</span>
<span class="cp">#define  YYSTAGP (t)       t = YYCURSOR</span>
<span class="cp">#define  YYSTAGN (t)       t = NULL</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="directives">
<h2>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h2>
<p>Below is the list of all directives provided by re2c (in no particular order).
More information on each directive can be found in the related sections.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">/*!re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code></dt>
<dd>A standard re2c block.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">%{</span> <span class="pre">...</span> <span class="pre">%}</span></code></dt>
<dd>A standard re2c block in <code class="docutils literal notranslate"><span class="pre">-F</span> <span class="pre">--flex-support</span></code> mode.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!rules:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code></dt>
<dd>A reusable re2c block (requires <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">--reuse</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!use:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code></dt>
<dd>A block that reuses previous rules-block specified with
<code class="docutils literal notranslate"><span class="pre">/*!rules:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code> (requires <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">--reuse</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!ignore:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code></dt>
<dd>A block which contents are ignored and cut off from the output file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!max:re2c*/</span></code></dt>
<dd>This directive is substituted with the macro-definition of <code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!maxnmatch:re2c*/</span></code></dt>
<dd>This directive is substituted with the macro-definition of <code class="docutils literal notranslate"><span class="pre">YYMAXNMATCH</span></code>
(requires <code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">--posix-captures</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!getstate:re2c*/</span></code></dt>
<dd>This directive is substituted with conditional dispatch on lexer state
(requires <code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">--storable-state</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!types:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code></dt>
<dd>This directive is substituted with the definition of condition <code class="docutils literal notranslate"><span class="pre">enum</span></code>
(requires <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">--conditions</span></code> option).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!stags:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code>, <code class="docutils literal notranslate"><span class="pre">/*!mtags:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code></dt>
<dd>These directives allow to specify a template piece of code that is expanded
for each s-tag/m-tag variable generated by re2c. This block has two optional
configurations: <code class="docutils literal notranslate"><span class="pre">format</span> <span class="pre">=</span> <span class="pre">&quot;&#64;&#64;&quot;;</span></code> (specifies the template where <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> is
substituted with the name of each tag variable), and <code class="docutils literal notranslate"><span class="pre">separator</span> <span class="pre">=</span> <span class="pre">&quot;&quot;;</span></code>
(specifies the piece of code used to join the generated pieces for different
tag variables).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!include:re2c</span> <span class="pre">FILE</span> <span class="pre">*/</span></code></dt>
<dd>This directive allows to include <code class="docutils literal notranslate"><span class="pre">FILE</span></code> (in the same sense as <code class="docutils literal notranslate"><span class="pre">#include</span></code>
directive in C/C++).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!header:re2c:on*/</span></code></dt>
<dd>This directive marks the start of header file. Everything after it and up to
the following <code class="docutils literal notranslate"><span class="pre">/*!header:re2c:off*/</span></code> directive is processed by re2c and
written to the header file specified with <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">--type-header</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/*!header:re2c:off*/</span></code></dt>
<dd>This directive marks the end of header file started with
<code class="docutils literal notranslate"><span class="pre">/*!header:re2c:on*/</span></code>.</dd>
</dl>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-?</span> <span class="pre">-h</span> <span class="pre">--help</span></code></dt>
<dd>Show help message.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-1</span> <span class="pre">--single-pass</span></code></dt>
<dd>Deprecated. Does nothing (single pass is the default now).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-8</span> <span class="pre">--utf-8</span></code></dt>
<dd>Generate a lexer that reads input in UTF-8 encoding.
re2c assumes that character range is 0 – 0x10FFFF and character size is
1 byte.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">--bit-vectors</span></code></dt>
<dd>Optimize conditional jumps using bit masks. Implies <code class="docutils literal notranslate"><span class="pre">-s</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">--conditions</span> <span class="pre">--start-conditions</span></code></dt>
<dd>Enable support of Flex-like “conditions”: multiple interrelated lexers
within one block. Option <code class="docutils literal notranslate"><span class="pre">--start-conditions</span></code> is a legacy alias; use
<code class="docutils literal notranslate"><span class="pre">--conditions</span></code> instead.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--case-insensitive</span></code></dt>
<dd>Treat single-quoted and double-quoted strings as case-insensitive.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--case-inverted</span></code></dt>
<dd>Invert the meaning of single-quoted and double-quoted strings:
treat single-quoted strings as case-sensitive and double-quoted strings
as case-insensitive.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">--emit-dot</span></code></dt>
<dd>Instead of normal output generate lexer graph in .dot format.
The output can be converted to an image with the help of Graphviz
(e.g. something like <code class="docutils literal notranslate"><span class="pre">dot</span> <span class="pre">-Tpng</span> <span class="pre">-odfa.png</span> <span class="pre">dfa.dot</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">--debug-output</span></code></dt>
<dd>Emit <code class="docutils literal notranslate"><span class="pre">YYDEBUG</span></code> in the generated code.
<code class="docutils literal notranslate"><span class="pre">YYDEBUG</span></code> should be defined by the user in the form of a void function
with two parameters: <code class="docutils literal notranslate"><span class="pre">state</span></code> (lexer state or -1) and <code class="docutils literal notranslate"><span class="pre">symbol</span></code> (current
input symbol of type <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dfa-minimization</span> <span class="pre">&lt;moore</span> <span class="pre">|</span> <span class="pre">table&gt;</span></code></dt>
<dd>The internal algorithm used by re2c to minimize the DFA: <code class="docutils literal notranslate"><span class="pre">moore</span></code> (the
default) is Moore algorithm, and <code class="docutils literal notranslate"><span class="pre">table</span></code> is the “table filling” algorithm.
Both algorithms should produce the same DFA up to states relabeling; table
filling is simpler and much slower and serves as a reference implementation.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-adfa</span></code></dt>
<dd>Debug option: output DFA after tunneling (in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-cfg</span></code></dt>
<dd>Debug option: output control flow graph of tag variables (in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-closure-stats</span></code></dt>
<dd>Debug option: output statistics on the number of states in closure.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-dfa-det</span></code></dt>
<dd>Debug option: output DFA immediately after determinization (in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-dfa-min</span></code></dt>
<dd>Debug option: output DFA after minimization (in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-dfa-tagopt</span></code></dt>
<dd>Debug option: output DFA after tag optimizations (in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-dfa-raw</span></code></dt>
<dd>Debug option: output DFA under construction with expanded state-sets
(in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-interf</span></code></dt>
<dd>Debug option: output interference table produced by liveness analysis of tag
variables.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--dump-nfa</span></code></dt>
<dd>Debug option: output NFA (in .dot format).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">--ecb</span></code></dt>
<dd>Generate a lexer that reads input in EBCDIC encoding.
re2c assumes that character range is 0 – 0xFF an character size is 1 byte.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--eager-skip</span></code></dt>
<dd>Make the generated lexer advance the input position “eagerly”:
immediately after reading input symbol.
By default this happens after transition to the next state.
Implied by <code class="docutils literal notranslate"><span class="pre">--no-lookahead</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--empty-class</span> <span class="pre">&lt;match-empty</span> <span class="pre">|</span> <span class="pre">match-none</span> <span class="pre">|</span> <span class="pre">error&gt;</span></code></dt>
<dd>Define the way re2c treats empty character classes. With <code class="docutils literal notranslate"><span class="pre">match-empty</span></code>
(the default) empty class matches empty input (which is illogical, but
backwards-compatible). With``match-none`` empty class always fails to match.
With <code class="docutils literal notranslate"><span class="pre">error</span></code> empty class raises a compilation error.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--encoding-policy</span> <span class="pre">&lt;fail</span> <span class="pre">|</span> <span class="pre">substitute</span> <span class="pre">|</span> <span class="pre">ignore&gt;</span></code></dt>
<dd>Define the way re2c treats Unicode surrogates.
With <code class="docutils literal notranslate"><span class="pre">fail</span></code> re2c aborts with an error when a surrogate is encountered.
With <code class="docutils literal notranslate"><span class="pre">substitute</span></code> re2c silently replaces surrogates with the error code
point 0xFFFD. With <code class="docutils literal notranslate"><span class="pre">ignore</span></code> (the default) re2c treats surrogates as
normal code points. The Unicode standard says that standalone surrogates
are invalid, but real-world libraries and programs behave in different ways.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">--storable-state</span></code></dt>
<dd>Generate a lexer which can store its inner state.
This is useful in push-model lexers which are stopped by an outer program
when there is not enough input, and then resumed when more input becomes
available. In this mode users should additionally define <code class="docutils literal notranslate"><span class="pre">YYGETSTATE()</span></code>
and <code class="docutils literal notranslate"><span class="pre">YYSETSTATE(state)</span></code> macros and variables <code class="docutils literal notranslate"><span class="pre">yych</span></code>, <code class="docutils literal notranslate"><span class="pre">yyaccept</span></code>
and <code class="docutils literal notranslate"><span class="pre">state</span></code> as part of the lexer state.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-F</span> <span class="pre">--flex-syntax</span></code></dt>
<dd>Partial support for Flex syntax: in this mode named definitions don’t need
the equal sign and the terminating semicolon, and when used they must be
surrounded by curly braces. Names without curly braces are treated as
double-quoted strings.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-g</span> <span class="pre">--computed-gotos</span></code></dt>
<dd>Optimize conditional jumps using non-standard “computed goto” extension
(which must be supported by the C/C++ compiler). re2c generates jump tables
only in complex cases with a lot of conditional branches. Complexity
threshold can be configured with <code class="docutils literal notranslate"><span class="pre">cgoto:threshold</span></code> configuration. This
option implies <code class="docutils literal notranslate"><span class="pre">-b</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-I</span> <span class="pre">PATH</span></code></dt>
<dd>Add <code class="docutils literal notranslate"><span class="pre">PATH</span></code> to the list of locations which are used when searching for
include files. This option is useful in combination with
<code class="docutils literal notranslate"><span class="pre">/*!include:re2c</span> <span class="pre">...</span> <span class="pre">*/</span></code> directive. Re2c looks for <code class="docutils literal notranslate"><span class="pre">FILE</span></code> in the
directory of including file and in the list of include paths specified by
<code class="docutils literal notranslate"><span class="pre">-I</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">--no-debug-info</span></code></dt>
<dd>Do not output <code class="docutils literal notranslate"><span class="pre">#line</span></code> information. This is useful when the generated code
is tracked by some version control system or IDE.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--input</span> <span class="pre">&lt;default</span> <span class="pre">|</span> <span class="pre">custom&gt;</span></code></dt>
<dd>Specify re2c input API.
Option <code class="docutils literal notranslate"><span class="pre">default</span></code> is the default API composed of pointer-like primitives
<code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code>, <code class="docutils literal notranslate"><span class="pre">YYMARKER</span></code>, <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code> etc.
Option <code class="docutils literal notranslate"><span class="pre">custom</span></code> is the generic API composed of function-like primitives
<code class="docutils literal notranslate"><span class="pre">YYPEEK()</span></code>, <code class="docutils literal notranslate"><span class="pre">YYSKIP()</span></code>, <code class="docutils literal notranslate"><span class="pre">YYBACKUP()</span></code>, <code class="docutils literal notranslate"><span class="pre">YYRESTORE()</span></code> etc.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--input-encoding</span> <span class="pre">&lt;ascii</span> <span class="pre">|</span> <span class="pre">utf8&gt;</span></code></dt>
<dd>Specify the way re2c parses regular expressions.
With <code class="docutils literal notranslate"><span class="pre">ascii</span></code> (the default) re2c handles input as ASCII-encoded: any
sequence of code units is a sequence of standalone 1-byte characters.
With <code class="docutils literal notranslate"><span class="pre">utf8</span></code> re2c handles input as UTF8-encoded and recognizes multibyte
characters.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--location-format</span> <span class="pre">&lt;gnu</span> <span class="pre">|</span> <span class="pre">msvc&gt;</span></code></dt>
<dd>Specify location format in messages.
With <code class="docutils literal notranslate"><span class="pre">gnu</span></code> locations are printed as ‘filename:line:column: …’.
With <code class="docutils literal notranslate"><span class="pre">msvc</span></code> locations are printed as ‘filename(line,column) …’.
Default is <code class="docutils literal notranslate"><span class="pre">gnu</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--no-generation-date</span></code></dt>
<dd>Suppress date output in the generated file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--no-lookahead</span></code></dt>
<dd>Use TDFA(0) instead of TDFA(1).
This option has effect only with <code class="docutils literal notranslate"><span class="pre">--tags</span></code> or <code class="docutils literal notranslate"><span class="pre">--posix-captures</span></code> options.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--no-optimize-tags</span></code></dt>
<dd>Suppress optimization of tag variables (useful for debugging).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--no-version</span></code></dt>
<dd>Suppress version output in the generated file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">OUTPUT</span> <span class="pre">--output=OUTPUT</span></code></dt>
<dd>Specify the <code class="docutils literal notranslate"><span class="pre">OUTPUT</span></code> file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">--posix-captures</span></code></dt>
<dd>Enable submatch extraction with POSIX-style capturing groups.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--posix-closure</span> <span class="pre">&lt;gor1</span> <span class="pre">|</span> <span class="pre">gtop&gt;</span></code></dt>
<dd>Specify shortest-path algorithm used for construction of epsilon-closure
with POSIX disambiguation semantics: <code class="docutils literal notranslate"><span class="pre">gor1</span></code> (the default) stands for
Goldberg-Radzik algorithm, and <code class="docutils literal notranslate"><span class="pre">gtop</span></code> stands for “global topological
order” algorithm.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">--reusable</span></code></dt>
<dd>Allows reuse of re2c rules with <code class="docutils literal notranslate"><span class="pre">/*!rules:re2c</span> <span class="pre">*/</span></code> and <code class="docutils literal notranslate"><span class="pre">/*!use:re2c</span> <span class="pre">*/</span></code>
blocks. Exactly one rules-block must be present. The rules are saved and
used by every use-block that follows, which may add its own rules and
configurations.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-S</span> <span class="pre">--skeleton</span></code></dt>
<dd>Ignore user-defined interface code and generate a self-contained “skeleton”
program. Additionally, generate input files with strings derived from the
regular grammar and compressed match results that are used to verify
“skeleton” behavior on all inputs. This option is useful for finding bugs
in optimizations and code generation.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">--nested-ifs</span></code></dt>
<dd>Use nested <code class="docutils literal notranslate"><span class="pre">if</span></code> statements instead of <code class="docutils literal notranslate"><span class="pre">switch</span></code> statements in conditional
jumps. This usually results in more efficient code with non-optimizing C/C++
compilers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-T</span> <span class="pre">--tags</span></code></dt>
<dd>Enable submatch extraction with tags.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">HEADER</span> <span class="pre">--type-header=HEADER</span></code></dt>
<dd>Generate a <code class="docutils literal notranslate"><span class="pre">HEADER</span></code> file that contains enum with condition names.
Requires <code class="docutils literal notranslate"><span class="pre">-c</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">--unicode</span></code></dt>
<dd>Generate a lexer that reads UTF32-encoded input. Re2c assumes that character
range is 0 – 0x10FFFF and character size is 4 bytes. This option implies
<code class="docutils literal notranslate"><span class="pre">-s</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-V</span> <span class="pre">--vernum</span></code></dt>
<dd>Show version information in <code class="docutils literal notranslate"><span class="pre">MMmmpp</span></code> format (major, minor, patch).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--verbose</span></code></dt>
<dd>Output a short message in case of success.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">--version</span></code></dt>
<dd>Show version information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">--wide-chars</span></code></dt>
<dd>Generate a lexer that reads UCS2-encoded input. Re2c assumes that character
range is 0 – 0xFFFF and character size is 2 bytes. This option implies
<code class="docutils literal notranslate"><span class="pre">-s</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">--utf-16</span></code></dt>
<dd>Generate a lexer that reads UTF16-encoded input. Re2c assumes that character
range is 0 – 0x10FFFF and character size is 2 bytes. This option implies
<code class="docutils literal notranslate"><span class="pre">-s</span></code>.</dd>
</dl>
</div>
<div class="section" id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">re2c:cgoto:threshold</span> <span class="pre">=</span> <span class="pre">9;</span></code></dt>
<dd>With <code class="docutils literal notranslate"><span class="pre">-g</span></code> <code class="docutils literal notranslate"><span class="pre">--computed-gotos</span></code> option this value specifies
the complexity threshold that triggers the generation of jump tables rather
than nested <code class="docutils literal notranslate"><span class="pre">if</span></code> statements and bit masks.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:cond:divider</span> <span class="pre">=</span> <span class="pre">'/*</span> <span class="pre">***********************************</span> <span class="pre">*/';</span></code></dt>
<dd>Allows to customize the divider for condition blocks. One can use <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> to insert condition name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:cond:divider&#64;cond</span> <span class="pre">=</span> <span class="pre">&#64;&#64;;</span></code></dt>
<dd>Specifies the placeholder that will be replaced with condition name in <code class="docutils literal notranslate"><span class="pre">re2c:cond:divider</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:condenumprefix</span> <span class="pre">=</span> <span class="pre">yyc;</span></code></dt>
<dd>Specifies the prefix used for condition identifiers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:cond:goto&#64;cond</span> <span class="pre">=</span> <span class="pre">&#64;&#64;;</span></code></dt>
<dd>Specifies the placeholder that will be replaced with condition label in <code class="docutils literal notranslate"><span class="pre">re2c:cond:goto</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:cond:goto</span> <span class="pre">=</span> <span class="pre">'goto</span> <span class="pre">&#64;&#64;;';</span></code></dt>
<dd>Allows to customize <code class="docutils literal notranslate"><span class="pre">goto</span></code> statements used with <code class="docutils literal notranslate"><span class="pre">:=&gt;</span></code> style rules.
One can use <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> to insert the condition name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:condprefix</span> <span class="pre">=</span> <span class="pre">yyc;</span></code></dt>
<dd>Specifies the prefix used for condition labels.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYBACKUPCTX</span> <span class="pre">=</span> <span class="pre">'YYBACKUPCTX';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYBACKUPCTX</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYBACKUP</span> <span class="pre">=</span> <span class="pre">'YYBACKUP';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYBACKUP</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYCONDTYPE</span> <span class="pre">=</span> <span class="pre">'YYCONDTYPE';</span></code></dt>
<dd>Enumeration type used for condition identifiers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYCTXMARKER</span> <span class="pre">=</span> <span class="pre">'YYCTXMARKER';</span></code></dt>
<dd>Replaces the <code class="docutils literal notranslate"><span class="pre">YYCTXMARKER</span></code> placeholder with the specified identifier.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYCTYPE</span> <span class="pre">=</span> <span class="pre">'YYCTYPE';</span></code></dt>
<dd>Replaces the <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> placeholder with the specified type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYCURSOR</span> <span class="pre">=</span> <span class="pre">'YYCURSOR';</span></code></dt>
<dd>Replaces the <code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code> placeholder with the specified identifier.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYDEBUG</span> <span class="pre">=</span> <span class="pre">'YYDEBUG';</span></code></dt>
<dd>Replaces the <code class="docutils literal notranslate"><span class="pre">YYDEBUG</span></code> placeholder with the specified identifier.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYFILL&#64;len</span> <span class="pre">=</span> <span class="pre">'&#64;&#64;';</span></code></dt>
<dd>Any occurrence of this text inside of a <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> will be replaced with the actual argument.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYFILL:naked</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Controls the argument in the parentheses after <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> and the following semicolon.
If zero, both the argument and the semicolon are omitted.
If non-zero, the argument is generated unless <code class="docutils literal notranslate"><span class="pre">re2c:yyfill:parameter</span></code> is set to zero;
the semicolon is generated unconditionally.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYFILL</span> <span class="pre">=</span> <span class="pre">'YYFILL';</span></code></dt>
<dd>Define a substitution for <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>.
By default re2c generates an argument in parentheses and a semicolon after <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>.
If you need to make <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> an arbitrary statement rather than a call,
set <code class="docutils literal notranslate"><span class="pre">re2c:define:YYFILL:naked</span></code> to a non-zero value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYGETCONDITION:naked</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Controls the parentheses after <code class="docutils literal notranslate"><span class="pre">YYGETCONDITION</span></code>.
If zero, the parentheses are omitted. If non-zero, the parentheses are generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYGETCONDITION</span> <span class="pre">=</span> <span class="pre">'YYGETCONDITION';</span></code></dt>
<dd>Substitution for <code class="docutils literal notranslate"><span class="pre">YYGETCONDITION</span></code>.
By default re2c generates parentheses after <code class="docutils literal notranslate"><span class="pre">YYGETCONDITION</span></code>.
Set <code class="docutils literal notranslate"><span class="pre">re2c:define:YYGETCONDITION:naked</span></code> to non-zero in order to omit the parentheses.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYGETSTATE:naked</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Controls the parentheses that follow <code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span></code>.
If zero, the parentheses are omitted. If non-zero, they are generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYGETSTATE</span> <span class="pre">=</span> <span class="pre">'YYGETSTATE';</span></code></dt>
<dd>Substitution for <code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span></code>.
By default re2c generates parentheses after <code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span></code>.
Set <code class="docutils literal notranslate"><span class="pre">re2c:define:YYGETSTATE:naked</span></code> to non-zero to omit the parentheses.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYLESSTHAN</span> <span class="pre">=</span> <span class="pre">'YYLESSTHAN';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYLESSTHAN</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYLIMIT</span> <span class="pre">=</span> <span class="pre">'YYLIMIT';</span></code></dt>
<dd>Replaces the <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code> placeholder with the specified identifier.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYMARKER</span> <span class="pre">=</span> <span class="pre">'YYMARKER';</span></code></dt>
<dd>Replaces the <code class="docutils literal notranslate"><span class="pre">YYMARKER</span></code> placeholder with the specified identifier.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYMTAGN</span> <span class="pre">=</span> <span class="pre">'YYMTAGN';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYMTAGN</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYMTAGP</span> <span class="pre">=</span> <span class="pre">'YYMTAGP';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYMTAGP</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYPEEK</span> <span class="pre">=</span> <span class="pre">'YYPEEK';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYPEEK</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYRESTORECTX</span> <span class="pre">=</span> <span class="pre">'YYRESTORECTX';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYRESTORECTX</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYRESTORE</span> <span class="pre">=</span> <span class="pre">'YYRESTORE';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYRESTORE</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYRESTORETAG</span> <span class="pre">=</span> <span class="pre">'YYRESTORETAG';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYRESTORETAG</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETCONDITION&#64;cond</span> <span class="pre">=</span> <span class="pre">'&#64;&#64;';</span></code></dt>
<dd>Any occurrence of this
text inside of <code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span></code> will be replaced with the actual argument.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETCONDITION:naked</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Controls the argument in parentheses
and the semicolon after <code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span></code>. If zero, both the argument and
the semicolon are omitted. If non-zero, both the argument and the semicolon are
generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETCONDITION</span> <span class="pre">=</span> <span class="pre">'YYSETCONDITION';</span></code></dt>
<dd>Substitution for
<code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span></code>. By default re2c generates an argument in
parentheses followed by semicolon after <code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span></code>. If you need to make
<code class="docutils literal notranslate"><span class="pre">YYSETCONDITION</span></code> an arbitrary statement rather than a call, set
<code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETCONDITION:naked</span></code> to non-zero.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETSTATE:naked</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Controls the argument in parentheses and the
semicolon after <code class="docutils literal notranslate"><span class="pre">YYSETSTATE</span></code>. If zero, both argument and the semicolon are
omitted. If non-zero, both the argument and the semicolon are generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETSTATE&#64;state</span> <span class="pre">=</span> <span class="pre">'&#64;&#64;';</span></code></dt>
<dd>Any occurrence of this text
inside of <code class="docutils literal notranslate"><span class="pre">YYSETSTATE</span></code> will be replaced with the actual argument.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETSTATE</span> <span class="pre">=</span> <span class="pre">'YYSETSTATE';</span></code></dt>
<dd>Substitution for
<code class="docutils literal notranslate"><span class="pre">YYSETSTATE</span></code>. By default re2c generates an argument in parentheses
followed by a semicolon after <code class="docutils literal notranslate"><span class="pre">YYSETSTATE</span></code>. If you need to make <code class="docutils literal notranslate"><span class="pre">YYSETSTATE</span></code> an
arbitrary statement rather than a call, set
<code class="docutils literal notranslate"><span class="pre">re2c:define:YYSETSTATE:naked</span></code> to non-zero.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSKIP</span> <span class="pre">=</span> <span class="pre">'YYSKIP';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYSKIP</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSTAGN</span> <span class="pre">=</span> <span class="pre">'YYSTAGN';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYSTAGN</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:define:YYSTAGP</span> <span class="pre">=</span> <span class="pre">'YYSTAGP';</span></code></dt>
<dd>Replaces <code class="docutils literal notranslate"><span class="pre">YYSTAGP</span></code> identifier with the specified string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:eof</span> <span class="pre">=</span> <span class="pre">-1;</span></code></dt>
<dd>Specifies the sentinel symbol used with EOF rule <code class="docutils literal notranslate"><span class="pre">$</span></code> to check for the end
of input in the generated lexer. Default value is <code class="docutils literal notranslate"><span class="pre">-1</span></code> (EOF rule is not
used). Other possible values include all valid code points. Only decimal
numbers are recognized.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:8</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:utf-8</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-8</span> <span class="pre">--utf-8</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:b</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:bit-vectors</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">--bit-vectors</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:case-insensitive</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--case-insensitive</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:case-inverted</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--case-inverted</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:d</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:debug-output</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">--debug-output</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:dfa-minimization</span> <span class="pre">=</span> <span class="pre">'moore';</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--dfa-minimization</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:eager-skip</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--eager-skip</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:e</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:ecb</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">--ecb</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:empty-class</span> <span class="pre">=</span> <span class="pre">'match-empty';</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--empty-class</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:encoding-policy</span> <span class="pre">=</span> <span class="pre">'ignore';</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--encoding-policy</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:g</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:computed-gotos</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-g</span> <span class="pre">--computed-gotos</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:i</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:no-debug-info</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">--no-debug-info</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:input</span> <span class="pre">=</span> <span class="pre">'default';</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">--input</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:lookahead</span> <span class="pre">=</span> <span class="pre">1;</span></code></dt>
<dd>Same as inverted <code class="docutils literal notranslate"><span class="pre">--no-lookahead</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:optimize-tags</span> <span class="pre">=</span> <span class="pre">1;</span></code></dt>
<dd>Same as inverted <code class="docutils literal notranslate"><span class="pre">--no-optimize-tags</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:P</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:posix-captures</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">--posix-captures</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:s</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:nested-ifs</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">--nested-ifs</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:T</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:tags</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-T</span> <span class="pre">--tags</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:u</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:unicode</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">--unicode</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:w</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:wide-chars</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">--wide-chars</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:flags:x</span></code> or <code class="docutils literal notranslate"><span class="pre">re2c:flags:utf-16</span></code></dt>
<dd>Same as <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">--utf-16</span></code> command-line option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:indent:string</span> <span class="pre">=</span> <span class="pre">'\t';</span></code></dt>
<dd>Specifies the string to use for indentation. Requires a string that contains
only whitespace (unless you need something else for external tools). The easiest
way to specify spaces is to enclose them in single or double quotes.
If you do  not want any indentation at all, you can set this to ‘’.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:indent:top</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Specifies the minimum amount of indentation to
use. Requires a numeric value greater than or equal to zero.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:labelprefix</span> <span class="pre">=</span> <span class="pre">'yy';</span></code></dt>
<dd>Allows to change the prefix of numbered
labels. The default is <code class="docutils literal notranslate"><span class="pre">yy</span></code>. Can be set any string that is valid in
a label name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:label:yyFillLabel</span> <span class="pre">=</span> <span class="pre">'yyFillLabel';</span></code></dt>
<dd>Overrides the name of the <code class="docutils literal notranslate"><span class="pre">yyFillLabel</span></code> label.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:label:yyNext</span> <span class="pre">=</span> <span class="pre">'yyNext';</span></code></dt>
<dd>Overrides the name of the <code class="docutils literal notranslate"><span class="pre">yyNext</span></code> label.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:startlabel</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>If set to a non zero integer, then the start
label of the next scanner block will be generated even if it isn’t used by
the scanner itself. Otherwise, the normal <code class="docutils literal notranslate"><span class="pre">yy0</span></code>-like start label is only
generated if needed. If set to a text value, then a label with that
text will be generated regardless of whether the normal start label is
used or not. This setting is reset to 0 after a start label has been generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:state:abort</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>When not zero and the <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> switch is active, then
the <code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span></code> block will contain a default case that aborts and a -1
case will be used for initialization.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:state:nextlabel</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>Used when <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> is active to control
whether the <code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span></code> block is followed by a <code class="docutils literal notranslate"><span class="pre">yyNext:</span></code> label line.
Instead of using <code class="docutils literal notranslate"><span class="pre">yyNext</span></code>, you can usually also use configuration
<code class="docutils literal notranslate"><span class="pre">startlabel</span></code> to force a specific start label or default to <code class="docutils literal notranslate"><span class="pre">yy0</span></code> as
a start label. Instead of using a dedicated label, it is often better to
separate the <code class="docutils literal notranslate"><span class="pre">YYGETSTATE</span></code> code from the actual scanner code by placing a
<code class="docutils literal notranslate"><span class="pre">/*!getstate:re2c*/</span></code> comment.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:tags:expression</span> <span class="pre">=</span> <span class="pre">'&#64;&#64;';</span></code></dt>
<dd>Allows to customize the way re2c addresses tag variables:
by default it emits expressions of the form <code class="docutils literal notranslate"><span class="pre">yyt&lt;N&gt;</span></code>,
but this might be inconvenient if tag variables are defined as fields in a struct,
or for any other reason require special accessors.
For example, setting <code class="docutils literal notranslate"><span class="pre">re2c:tags:expression</span> <span class="pre">=</span> <span class="pre">p-&gt;&#64;&#64;</span></code> will result in <code class="docutils literal notranslate"><span class="pre">p-&gt;yyt&lt;N&gt;</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:tags:prefix</span> <span class="pre">=</span> <span class="pre">'yyt';</span></code></dt>
<dd>Allows to override prefix of tag variables.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:variable:yyaccept</span> <span class="pre">=</span> <span class="pre">yyaccept;</span></code></dt>
<dd>Overrides the name of the <code class="docutils literal notranslate"><span class="pre">yyaccept</span></code> variable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:variable:yybm</span> <span class="pre">=</span> <span class="pre">'yybm';</span></code></dt>
<dd>Overrides the name of the <code class="docutils literal notranslate"><span class="pre">yybm</span></code> variable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:variable:yych</span> <span class="pre">=</span> <span class="pre">'yych';</span></code></dt>
<dd>Overrides the name of the <code class="docutils literal notranslate"><span class="pre">yych</span></code> variable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:variable:yyctable</span> <span class="pre">=</span> <span class="pre">'yyctable';</span></code></dt>
<dd>When both <code class="docutils literal notranslate"><span class="pre">-c</span></code> <code class="docutils literal notranslate"><span class="pre">--conditions</span></code> and <code class="docutils literal notranslate"><span class="pre">-g</span></code> <code class="docutils literal notranslate"><span class="pre">--computed-gotos</span></code> are active,
re2c will use this variable to generate a static jump table
for <code class="docutils literal notranslate"><span class="pre">YYGETCONDITION</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:variable:yystable</span> <span class="pre">=</span> <span class="pre">'yystable';</span></code></dt>
<dd>Deprecated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:variable:yytarget</span> <span class="pre">=</span> <span class="pre">'yytarget';</span></code></dt>
<dd>Overrides the name of the <code class="docutils literal notranslate"><span class="pre">yytarget</span></code> variable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:yybm:hex</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>If set to zero, a decimal table will be used. Otherwise, a hexadecimal table will be generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:yych:conversion</span> <span class="pre">=</span> <span class="pre">0;</span></code></dt>
<dd>When this setting is non zero, re2c automatically generates
conversion code whenever yych gets read. In this case, the type must be
defined using <code class="docutils literal notranslate"><span class="pre">re2c:define:YYCTYPE</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:yych:emit</span> <span class="pre">=</span> <span class="pre">1;</span></code></dt>
<dd>Set this to zero to suppress the generation of <em>yych</em>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:yyfill:check</span> <span class="pre">=</span> <span class="pre">1;</span></code></dt>
<dd>This can be set to 0 to suppress the generations of
<code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code> and <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code> based precondition checks. This option is useful when
<code class="docutils literal notranslate"><span class="pre">YYLIMIT</span> <span class="pre">+</span> <span class="pre">YYMAXFILL</span></code> is always accessible.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:yyfill:enable</span> <span class="pre">=</span> <span class="pre">1;</span></code></dt>
<dd>Set this to zero to suppress the generation of <code class="docutils literal notranslate"><span class="pre">YYFILL</span> <span class="pre">(n)</span></code>. When using this, be sure to verify that the generated
scanner does not read beyond the available input, as allowing such behavior might
introduce severe security issues to your programs.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">re2c:yyfill:parameter</span> <span class="pre">=</span> <span class="pre">1;</span></code></dt>
<dd>Controls the argument in the parentheses that follow <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>. If zero, the argument is omitted.
If non-zero, the argument is generated unless <code class="docutils literal notranslate"><span class="pre">re2c:define:YYFILL:naked</span></code> is set to non-zero.</dd>
</dl>
</div>
<div class="section" id="eof-handling">
<h2>EOF handling<a class="headerlink" href="#eof-handling" title="Permalink to this headline">¶</a></h2>
<p>Re2c provides a number of ways to handle end-of-input situation. Which way to
use depends on the complexity of regular expressions, performance
considerations, the need for input buffering and various other factors. EOF
handling is probably the most complex part of re2c user interface — it
definitely requires a bit of understanding of how the generated lexer works.
But in return is allows the user to customize lexer for a particular environment
and avoid the unnecessary overhead of generic methods when a simpler method is
sufficient. Roughly speaking, there are four main methods:</p>
<ul class="simple">
<li>using sentinel symbol (simple and efficient, but limited)</li>
<li>bounds checking with padding (generic, but complex)</li>
<li>EOF rule: a combination of sentinel symbol and bounds checking (generic and
simple, can be more or less efficient than bounds checking with padding
depending on the grammar)</li>
<li>using generic API (user-defined, so may be incorrect ;])</li>
</ul>
<div class="section" id="using-sentinel-symbol">
<h3>Using sentinel symbol<a class="headerlink" href="#using-sentinel-symbol" title="Permalink to this headline">¶</a></h3>
<p>This is the simplest and the most efficient method. It is applicable in cases
when the input is small enough to fit into a continuous memory buffer and there
is a natural “sentinel” symbol — a code unit that is not allowed by any of the
regular expressions in grammar (except possibly as a terminating character).
Sentinel symbol never appears in well-formed input, therefore it can be appended
at the end of input and used as a stop signal by the lexer. A good example of
such input is a null-terminated C-string, provided that the grammar does not
allow <code class="docutils literal notranslate"><span class="pre">NULL</span></code> in the middle of lexemes. Sentinel method is very efficient,
because the lexer does not need to perform any additional checks for the end of
input — it comes naturally as a part of processing the next character.</p>
<p>Below is an example of using sentinel method. Configuration
<code class="docutils literal notranslate"><span class="pre">re2c:yyfill:enable</span> <span class="pre">=</span> <span class="pre">0;</span></code> suppresses generation of end-of-input checks and
<code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> calls.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>

<span class="cm">    *      { return -1; }</span>
<span class="cm">    [\x00] { return count; }</span>
<span class="cm">    [a-z]+ { ++count; goto loop; }</span>
<span class="cm">    [ ]+   { goto loop; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two 123?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="bounds-checking-with-padding">
<h3>Bounds checking with padding<a class="headerlink" href="#bounds-checking-with-padding" title="Permalink to this headline">¶</a></h3>
<p>Bounds checking is a generic method: it can be used with any input grammar.
The basic idea is simple: we need to check for the end of input before reading
the next input character. However, if implemented in a straightforward way, this
would be quite inefficient: checking on each input character would cause a major
slowdown. Re2c avoids slowdown by generating checks only in certain key states
of the lexer, and letting it run without checks in-between the key states.
More precisely, re2c computes strongly connected components (SCCs) of
the underlying DFA (which roughly correspond to loops), and generates only a few
checks per each SCC (usually just one, but in general enough to make the SCC
acyclic). The check is of the form <code class="docutils literal notranslate"><span class="pre">(YYLIMIT</span> <span class="pre">-</span> <span class="pre">YYCURSOR)</span> <span class="pre">&lt;</span> <span class="pre">n</span></code>, where <code class="docutils literal notranslate"><span class="pre">n</span></code>
is the maximal length of a simple path in the corresponding SCC. If this
condiiton is true, the lexer calls <code class="docutils literal notranslate"><span class="pre">YYFILL(n)</span></code>, which must either supply at
least <code class="docutils literal notranslate"><span class="pre">n</span></code> input characters, or do not return. When the lexer continues after
the check, it is certain that the next <code class="docutils literal notranslate"><span class="pre">n</span></code> characters can be read safely
without checks.</p>
<p>This approach reduces the number of checks significantly (and makes the lexer
much faster as a result), but it has a downside. Since the lexer checks for
multiple characters at once, it may end up in a situation when there are a few
remaining input characters (less than <code class="docutils literal notranslate"><span class="pre">n</span></code>) corresponding to a short path in
the SCC, but the lexer cannot proceed because of the check, and <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>
cannot supply more character because it is the end of input. To solve this
problem, re2c requires that additional padding consisting of fake characters is
appended at the end of input. The length of padding should be <code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code>,
which equals to the maximum <code class="docutils literal notranslate"><span class="pre">n</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> and must be generated
by re2c using <code class="docutils literal notranslate"><span class="pre">/*!max:re2c*/</span></code> directive. The fake characters should not form a
valid lexeme suffix, otherwise the lexer may be fooled into matching a fake
lexeme. Usually it’s a good idea to use <code class="docutils literal notranslate"><span class="pre">NULL</span></code> characters for padding.</p>
<p>Below is an example of using bounds checking with padding. Note that the grammar
rule for single-quoted strings allows arbitrary symbols in the middle of lexeme,
so there is no natural sentinel in the grammar. Strings like <code class="docutils literal notranslate"><span class="pre">&quot;aha\0ha&quot;</span></code> are
perfectly valid, but ill-formed strings like <code class="docutils literal notranslate"><span class="pre">&quot;aha\0</span></code> are also possible and
shouldn’t crash the lexer. In this example we do not use buffer refilling,
therefore <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> definition simply returns an error. Note that <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>
will only be called after the lexer reaches padding, because only then will the
check condition be satisfied.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cm">/*!max:re2c*/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="n">YYMAXFILL</span><span class="p">);</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">YYMAXFILL</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYLIMIT</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">len</span> <span class="o">+</span> <span class="n">YYMAXFILL</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">loop</span><span class="p">:</span>
    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:define:YYFILL:naked = 1;</span>
<span class="cm">    re2c:define:YYFILL = &quot;goto error;&quot;;</span>

<span class="cm">    *                         { goto error; }</span>
<span class="cm">    [\x00]                    { if (YYCURSOR == YYLIMIT) goto end; else goto error; }</span>
<span class="cm">    [a-z]+                    { ++count; goto loop; }</span>
<span class="cm">    [&#39;] ([^&#39;] | [\\][&#39;])* [&#39;] { ++count; goto loop; }</span>
<span class="cm">    [ ]+                      { goto loop; }</span>

<span class="cm">    */</span>
<span class="nl">error</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="nl">end</span><span class="p">:</span>
    <span class="n">free</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two 123?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one &#39;two&#39; &#39;th</span><span class="se">\\</span><span class="s">&#39;ree&#39; &#39;123?&#39; &#39;&#39;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one &#39;two&#39; &#39;three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="eof-rule">
<h3>EOF rule<a class="headerlink" href="#eof-rule" title="Permalink to this headline">¶</a></h3>
<p>EOF rule <code class="docutils literal notranslate"><span class="pre">$</span></code> was introduced in version 1.2. It is a hybrid approach that tries
to take the best of both worlds: simplicity and efficiency of the sentinel
method combined with the generality of bounds-checking method. The idea is to
appoint an arbitrary symbol to be the sentinel, and only perform further bounds
checking if the sentinel symbol matches (more precisely, if the symbol class that
contains it matches). The check is of the form <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span> <span class="pre">&lt;=</span> <span class="pre">YYCURSOR</span></code>.
If this condition is not satisfied, then the sentinel is just an ordinary input
character and the lexer continues. Otherwise this is a real sentinel, and the
lexer calls <code class="docutils literal notranslate"><span class="pre">YYFILL()</span></code>. If <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> returns zero, the lexer assumes that it
has more input and tries to re-match. Otherwise <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> returns non-zero and
the lexer knows that it has reached the end of input. At this point there are
three possibilities. First, it might have already matched a shorter lexeme —
in this case it just rolls back to the last accepting state. Second, it might
have consumed some characters, but failed to match — in this case it falls
back to default rule <code class="docutils literal notranslate"><span class="pre">*</span></code>. Finally, it might be in the initial state — in
this (and only this!) case it matches EOF rule <code class="docutils literal notranslate"><span class="pre">$</span></code>.</p>
<p>Below is an example of using EOF rule. Configuration <code class="docutils literal notranslate"><span class="pre">re2c:yyfill:enable</span> <span class="pre">=</span> <span class="pre">0;</span></code>
suppresses generation of <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> calls (but not the bounds checks).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYLIMIT</span> <span class="o">=</span> <span class="n">str</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">loop</span><span class="p">:</span>
    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>
<span class="cm">    re2c:eof = 0;</span>

<span class="cm">    *                         { return -1; }</span>
<span class="cm">    $                         { return count; }</span>
<span class="cm">    [a-z]+                    { ++count; goto loop; }</span>
<span class="cm">    [&#39;] ([^&#39;] | [\\][&#39;])* [&#39;] { ++count; goto loop; }</span>
<span class="cm">    [ ]+                      { goto loop; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two 123?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one &#39;two&#39; &#39;th</span><span class="se">\\</span><span class="s">&#39;ree&#39; &#39;123?&#39; &#39;&#39;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one &#39;two&#39; &#39;three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-generic-api">
<h3>Using generic API<a class="headerlink" href="#using-generic-api" title="Permalink to this headline">¶</a></h3>
<p>Generic API can be used with any of the above methods. It also allows to use a
user-defined method by placing EOF checks in one of the basic primitives.
Usually this is either <code class="docutils literal notranslate"><span class="pre">YYSKIP</span></code> (the check is performed when advancing to the
next input character), or <code class="docutils literal notranslate"><span class="pre">YYPEEK</span></code> (the check is performed when reading the
next input character). The resulting methods are inefficient, as they check on
each input character. However, they can be useful in cases when the input cannot
be buffered or padded and does not contain a sentinel character at the end. One
should be cautious when using such ad-hoc methods, as it is easy to overlook
some corner cases and come up with a method that only partially works. Also it
should be noted that not everything can be expressed via generic API: for
example, it is impossible to reimplement the way EOF rule works (in particular,
it is impossible to re-match the character after successfull <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>).</p>
<p>Below is an example of using <code class="docutils literal notranslate"><span class="pre">YYSKIP</span></code> to perform bounds checking without
padding. <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> generation is suppressed using <code class="docutils literal notranslate"><span class="pre">re2c:yyfill:enable</span> <span class="pre">=</span> <span class="pre">0;</span></code>
configuration. Note that if the grammar was more complex, this method might not
work in case when two rules overlap and EOF check fails after a shorter lexeme
has already been matched (as it happens in our example, there are no overlapping
rules).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#define YYPEEK() *cur</span>
<span class="cp">#define YYSKIP() if (++cur &gt; lim) return -1</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cur</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lim</span> <span class="o">=</span> <span class="n">str</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">loop</span><span class="p">:</span>
    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>
<span class="cm">    re2c:flags:input = custom;</span>

<span class="cm">    *                         { return -1; }</span>
<span class="cm">    [\x00]                    { return cur == lim ? count : -1; }</span>
<span class="cm">    [a-z]+                    { ++count; goto loop; }</span>
<span class="cm">    [&#39;] ([^&#39;] | [\\][&#39;])* [&#39;] { ++count; goto loop; }</span>
<span class="cm">    [ ]+                      { goto loop; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one two 123?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one &#39;two&#39; &#39;th</span><span class="se">\\</span><span class="s">&#39;ree&#39; &#39;123?&#39; &#39;&#39;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one &#39;two&#39; &#39;three&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="buffer-refilling">
<h2>Buffer refilling<a class="headerlink" href="#buffer-refilling" title="Permalink to this headline">¶</a></h2>
<p>The need for buffering arises when the input cannot be mapped in memory all at
once: either it is too large, or it comes in a streaming fashion (like reading
from a socket). The usual technique in such cases is to allocate a fixed-sized
memory buffer and process input in chunks that fit into the buffer. When the
current chunk is processed, it is moved out and new data is moved in. In
practice it is somewhat more complex, because lexer state consists not of a
single input position, but a set of interrelated posiitons:</p>
<ul class="simple">
<li>cursor: the next input character to be read (<code class="docutils literal notranslate"><span class="pre">YYCURSOR</span></code> in default API or
<code class="docutils literal notranslate"><span class="pre">YYSKIP</span></code>/<code class="docutils literal notranslate"><span class="pre">YYPEEK</span></code> in generic API)</li>
<li>limit: the position after the last available input character (<code class="docutils literal notranslate"><span class="pre">YYLIMIT</span></code> in
default API, implicitly handled by <code class="docutils literal notranslate"><span class="pre">YYLESSTHAN</span></code> in generic API)</li>
<li>marker: the position of the most recent match, if any (<code class="docutils literal notranslate"><span class="pre">YYMARKER</span></code> in default
API or <code class="docutils literal notranslate"><span class="pre">YYBACKUP</span></code>/<code class="docutils literal notranslate"><span class="pre">YYRESTORE</span></code> in generic API)</li>
<li>token: the start of the current lexeme (implicit in re2c API, as it is not
needed for the normal lexer operation and can be defined and updated by the
user)</li>
<li>context marker: the position of the trailing context (<code class="docutils literal notranslate"><span class="pre">YYCTXMARKER</span></code> in
default API or <code class="docutils literal notranslate"><span class="pre">YYBACKUPCTX</span></code>/<code class="docutils literal notranslate"><span class="pre">YYRESTORECTX</span></code> in generic API)</li>
<li>tag variables: submatch positions (defined with <code class="docutils literal notranslate"><span class="pre">/*!stags:re2c*/</span></code> and
<code class="docutils literal notranslate"><span class="pre">/*!mtags:re2c*/</span></code> directives and
<code class="docutils literal notranslate"><span class="pre">YYSTAGP</span></code>/<code class="docutils literal notranslate"><span class="pre">YYSTAGN</span></code>/<code class="docutils literal notranslate"><span class="pre">YYMTAGP</span></code>/<code class="docutils literal notranslate"><span class="pre">YYMTAGN</span></code> in generic API)</li>
</ul>
<p>Not all these are used in every case, but if used, they must be updated by
<code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>. All active positions are contained in the segment between token and
cursor, therefore everything between buffer start and token can be discarded,
the segment from token and up to limit should be moved to the beginning of
buffer, and the free space at the end of buffer should be filled with new data.
In order to avoid frequent <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> calls it is best to fill in as many input
characters as possible (even though fewer characters might suffice to resume the
lexer). The details of <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> implementation are slightly different
depending on which EOF handling method is used: the case of EOF rule is somewhat
simpler than the case of bounds-checking with padding. Also note that if
<code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">--storable-state</span></code> option is used, <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> has slightly different
semantics (desrbed in the section about storable state).</p>
<div class="section" id="yyfill-with-eof-rule">
<h3>YYFILL with EOF rule<a class="headerlink" href="#yyfill-with-eof-rule" title="Permalink to this headline">¶</a></h3>
<p>If EOF rule is used, <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> is a function-like primitive that accepts
no arguments and returns a value which is checked against zero. <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>
invocation is triggered by condition <code class="docutils literal notranslate"><span class="pre">YYLIMIT</span> <span class="pre">&lt;=</span> <span class="pre">YYCURSOR</span></code> in default API and
<code class="docutils literal notranslate"><span class="pre">YYLESSTHAN()</span></code> in generic API. A non-zero return value means that <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>
has failed. A successful <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> call must supply at least one character and
adjust input positions accordingly. Limit must always be set to one after the
last input position in buffer, and the character at the limit position must be
the sentinel symbol specified by <code class="docutils literal notranslate"><span class="pre">re2c:eof</span></code> configuration. The pictures below
show the relative locations of input positions in buffer before and after
<code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> call (sentinel symbol is marked with <code class="docutils literal notranslate"><span class="pre">#</span></code>, and the second picture
shows the case when there is not enough input to fill the whole buffer).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>               &lt;-- shift --&gt;
             &gt;-A------------B---------C-------------D#-----------E-&gt;
             buffer       token    marker         limit,
                                                  cursor
&gt;-A------------B---------C-------------D------------E#-&gt;
             buffer,  marker        cursor        limit
             token

               &lt;-- shift --&gt;
             &gt;-A------------B---------C-------------D#--E (EOF)
             buffer       token    marker         limit,
                                                  cursor
&gt;-A------------B---------C-------------D---E#........
             buffer,  marker       cursor limit
             token
</pre></div>
</div>
<p>Here is an example of a program that reads input file <code class="docutils literal notranslate"><span class="pre">input.txt</span></code> in chunks of
4096 bytes and uses EOF rule.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#define SIZE 4096</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">lim</span><span class="p">,</span> <span class="o">*</span><span class="n">cur</span><span class="p">,</span> <span class="o">*</span><span class="n">tok</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">eof</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Input</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">eof</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">free</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">-</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">free</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">memmove</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">-</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span><span class="p">);</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">-=</span> <span class="n">free</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">-=</span> <span class="n">free</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">-=</span> <span class="n">free</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">+=</span> <span class="n">fread</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">free</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">file</span><span class="p">);</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">|=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">+</span> <span class="n">SIZE</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">+</span> <span class="n">SIZE</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fill</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define YYFILL() fill(in)</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:define:YYCURSOR = in-&gt;cur;</span>
<span class="cm">    re2c:define:YYLIMIT = in-&gt;lim;</span>
<span class="cm">    re2c:eof = 0;</span>

<span class="cm">    *                         { return -1; }</span>
<span class="cm">    $                         { return count; }</span>
<span class="cm">    [a-z]+                    { ++count; goto loop; }</span>
<span class="cm">    [&#39;] ([^&#39;] | [\\][&#39;])* [&#39;] { ++count; goto loop; }</span>
<span class="cm">    [ ]+                      { goto loop; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;input.txt&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">f</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">Input</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;count: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">));</span>

    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="yyfill-with-padding">
<h3>YYFILL with padding<a class="headerlink" href="#yyfill-with-padding" title="Permalink to this headline">¶</a></h3>
<p>In the default case (when EOF rule is not used) <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> is a function-like
primitive that accepts a single argument and does not return any value.
<code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> invocation is triggered by condition <code class="docutils literal notranslate"><span class="pre">(YYLIMIT</span> <span class="pre">-</span> <span class="pre">YYCURSOR)</span> <span class="pre">&lt;</span> <span class="pre">n</span></code> in
default API and <code class="docutils literal notranslate"><span class="pre">YYLESSTHAN(n)</span></code> in generic API. The argument passed to
<code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> is the minimal number of characters that must be supplied. If it
fails to do so, <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> must not return to the lexer (for that reason it is
best implemented as a macro that returns from the calling function on failure).
In case of a successfull <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> invocation the limit position must be set
either to one after the last input position in buffer, or to the end of
<code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code> padding (in case <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> has successfully read at least <code class="docutils literal notranslate"><span class="pre">n</span></code>
characters, but not enough to fill the entire buffer). The pictures below show
the relative locations of input positions in buffer before and after <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>
invocation (<code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code> padding on the second picture is marked with <code class="docutils literal notranslate"><span class="pre">#</span></code>
symbols).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>               &lt;-- shift --&gt;                 &lt;-- need --&gt;
             &gt;-A------------B---------C-----D-------E---F--------G-&gt;
             buffer       token    marker cursor  limit

&gt;-A------------B---------C-----D-------E---F--------G-&gt;
             buffer,  marker cursor               limit
             token

               &lt;-- shift --&gt;                 &lt;-- need --&gt;
             &gt;-A------------B---------C-----D-------E-F        (EOF)
             buffer       token    marker cursor  limit

&gt;-A------------B---------C-----D-------E-F###############
             buffer,  marker cursor                   limit
             token                        &lt;- YYMAXFILL -&gt;
</pre></div>
</div>
<p>Here is an example of a program that reads input file <code class="docutils literal notranslate"><span class="pre">input.txt</span></code> in chunks of
4096 bytes and uses bounds-checking with padding.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cm">/*!max:re2c*/</span>
<span class="cp">#define SIZE 4096</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">SIZE</span> <span class="o">+</span> <span class="n">YYMAXFILL</span><span class="p">],</span> <span class="o">*</span><span class="n">lim</span><span class="p">,</span> <span class="o">*</span><span class="n">cur</span><span class="p">,</span> <span class="o">*</span><span class="n">tok</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">eof</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Input</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">need</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">eof</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">free</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">-</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">free</span> <span class="o">&lt;</span> <span class="n">need</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">memmove</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">-</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span><span class="p">);</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">-=</span> <span class="n">free</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">-=</span> <span class="n">free</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">-=</span> <span class="n">free</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">+=</span> <span class="n">fread</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">free</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">file</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">+</span> <span class="n">SIZE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">in</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">YYMAXFILL</span><span class="p">);</span>
        <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">+=</span> <span class="n">YYMAXFILL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">+</span> <span class="n">SIZE</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fill</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define YYFILL(n) if (fill(in, n) != 0) return -1</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:define:YYCURSOR = in-&gt;cur;</span>
<span class="cm">    re2c:define:YYLIMIT = in-&gt;lim;</span>

<span class="cm">    *                         { return -1; }</span>
<span class="cm">    [\x00]                    { return (YYMAXFILL == in-&gt;lim - in-&gt;tok) ? count : -1; }</span>
<span class="cm">    [a-z]+                    { ++count; goto loop; }</span>
<span class="cm">    [&#39;] ([^&#39;] | [\\][&#39;])* [&#39;] { ++count; goto loop; }</span>
<span class="cm">    [ ]+                      { goto loop; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;input.txt&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">f</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">Input</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;count: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">));</span>

    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="include-files">
<h2>Include files<a class="headerlink" href="#include-files" title="Permalink to this headline">¶</a></h2>
<p>Re2c allows to include other files using directive <code class="docutils literal notranslate"><span class="pre">/*!include:re2c</span> <span class="pre">FILE</span> <span class="pre">*/</span></code>,
where <code class="docutils literal notranslate"><span class="pre">FILE</span></code> is the name of file to be included. Re2c looks for included
files in the directory of the including file and in include locations, which
can be specified with <code class="docutils literal notranslate"><span class="pre">-I</span></code> option.
Re2c include directive works in the same way as C/C++ <code class="docutils literal notranslate"><span class="pre">#include</span></code>: the contents
of <code class="docutils literal notranslate"><span class="pre">FILE</span></code> are copy-pasted verbatim in place of the directive. Include files
may have further includes of their own.
Re2c provides some predefined include files that can be found in the
<code class="docutils literal notranslate"><span class="pre">include/</span></code> subdirectory of the project. These files contain definitions that
can be useful to other projects (such as Unicode categories) and form something
like a standard library for re2c.</p>
<p>Here is an example of using include files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// definitions.re</span>
<span class="cm">/*!re2c</span>
<span class="cm">    alpha = [a-zA-Z];</span>
<span class="cm">    digit = [0-9];</span>
<span class="cm">*/</span>

<span class="c1">// main.re</span>
<span class="cm">/*!include:re2c &quot;definitions.re&quot; */</span>
<span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">        alpha { return 1; }</span>
<span class="cm">        digit { return 2; }</span>
<span class="cm">        *     { return 0; }</span>
<span class="cm">    */</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="header-files">
<h2>Header files<a class="headerlink" href="#header-files" title="Permalink to this headline">¶</a></h2>
<p>Re2c allows to generate header file from the input <code class="docutils literal notranslate"><span class="pre">.re</span></code> file using option
<code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">--type-header</span></code> (or the corresponding configurations) and directives
<code class="docutils literal notranslate"><span class="pre">/*!header:re2c:on*/</span></code> and <code class="docutils literal notranslate"><span class="pre">/*!header:re2c:off*/</span></code>. The first directive
marks the beginning of header file, and the second directive marks the end of
it. Everything between these directives is processed by re2c, and the generated
code is written to the file specified by the <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">--type-header</span></code> option (or
<code class="docutils literal notranslate"><span class="pre">stdout</span></code> if this option was not used). Autogenerated header file may be needed
in cases when re2c is used to generate definitions of constants, variables and
structs that must be visible from other translation units.</p>
<p>Here is an example of generating a header that contains definitions of
<code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code> and lexer state with tag variables. Note that <code class="docutils literal notranslate"><span class="pre">YYMAXFILL</span></code> and
tag variables depend on the grammar in the <code class="docutils literal notranslate"><span class="pre">.re</span></code> file and cannot be
hard-coded.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!header:re2c:on*/</span>
<span class="cm">/*!max:re2c*/</span>
<span class="k">struct</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">4096</span> <span class="o">+</span> <span class="n">YYMAXFILL</span><span class="p">],</span> <span class="o">*</span><span class="n">cursor</span><span class="p">,</span> <span class="o">*</span><span class="n">marker</span><span class="p">,</span> <span class="o">*</span><span class="n">limit</span><span class="p">;</span>
    <span class="cm">/*!stags:re2c format = &quot;char *@@; &quot;; */</span>
<span class="p">};</span>
<span class="cm">/*!header:re2c:off*/</span>

<span class="cp">#include</span> <span class="cpf">&quot;lex.h&quot;</span><span class="cp"></span>
<span class="cp">#define YYCTYPE   char</span>
<span class="cp">#define YYCURSOR  state-&gt;cursor</span>
<span class="cp">#define YYMARKER  state-&gt;marker</span>
<span class="cp">#define YYLIMIT   state-&gt;limit</span>
<span class="cp">#define YYFILL(n) return 2</span>
<span class="kt">int</span> <span class="nf">lex</span><span class="p">(</span><span class="n">State</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">        re2c:tags:expression = state-&gt;@@;</span>
<span class="cm">        re2c:flags:t         = lex.h;</span>

<span class="cm">        &quot;a&quot;* @x &quot;b&quot;* @y &quot;c&quot;* { return 0; }</span>
<span class="cm">        *                    { return 1; }</span>
<span class="cm">    */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The generated header looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define YYMAXFILL 1</span>

<span class="k">struct</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">4096</span> <span class="o">+</span> <span class="n">YYMAXFILL</span><span class="p">],</span> <span class="o">*</span><span class="n">cursor</span><span class="p">,</span> <span class="o">*</span><span class="n">marker</span><span class="p">,</span> <span class="o">*</span><span class="n">limit</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">yyt1</span><span class="p">;</span> <span class="kt">char</span> <span class="o">*</span><span class="n">yyt2</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="submatch-extraction">
<h2>Submatch extraction<a class="headerlink" href="#submatch-extraction" title="Permalink to this headline">¶</a></h2>
<p>Re2c has two options for submatch extraction.</p>
<p>The first option is <code class="docutils literal notranslate"><span class="pre">-T</span> <span class="pre">--tags</span></code>. With this option one can use standalone tags
of the form <code class="docutils literal notranslate"><span class="pre">&#64;stag</span></code> and <code class="docutils literal notranslate"><span class="pre">#mtag</span></code>, where <code class="docutils literal notranslate"><span class="pre">stag</span></code> and <code class="docutils literal notranslate"><span class="pre">mtag</span></code> are arbitrary
used-defined names. Tags can be used anywhere inside of a regular expression;
semantically they are just position markers. Tags of the form <code class="docutils literal notranslate"><span class="pre">&#64;stag</span></code> are
called s-tags: they denote a single submatch value (the last input position
where this tag matched). Tags of the form <code class="docutils literal notranslate"><span class="pre">#mtag</span></code> are called m-tags: they
denote multiple submatch values (the whole history of repetitions of this tag).
All tags should be defined by the user as variables with the corresponding
names. With standalone tags re2c uses leftmost greedy disambiguation: submatch
positions correspond to the leftmost matching path through the regular
expression.</p>
<p>The second option is <code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">--posix-captures</span></code>: it enables POSIX-compliant
capturing groups. In this mode parentheses in regular expressions denote the
beginning and the end of capturing groups; the whole regular expression is group
number zero. The number of groups for the matching rule is stored in a variable
<code class="docutils literal notranslate"><span class="pre">yynmatch</span></code>, and submatch results are stored in <code class="docutils literal notranslate"><span class="pre">yypmatch</span></code> array. Both
<code class="docutils literal notranslate"><span class="pre">yynmatch</span></code> and <code class="docutils literal notranslate"><span class="pre">yypmatch</span></code> should be defined by the user, and <code class="docutils literal notranslate"><span class="pre">yypmatch</span></code>
size must be at least <code class="docutils literal notranslate"><span class="pre">[yynmatch</span> <span class="pre">*</span> <span class="pre">2]</span></code>. Re2c provides a directive
<code class="docutils literal notranslate"><span class="pre">/*!maxnmatch:re2c*/</span></code> that defines <code class="docutils literal notranslate"><span class="pre">YYMAXNMATCH</span></code>: a constant  equal to the
maximal value of <code class="docutils literal notranslate"><span class="pre">yynmatch</span></code> among all rules. Note that re2c implements
POSIX-compliant disambiguation: each subexpression matches as long as possible,
and subexpressions that start earlier in regular expression have priority over
those starting later. Capturing groups are translated into s-tags under the
hood, therefore we use the word “tag” to describe them as well.</p>
<p>With both <code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">--posix-captures</span></code> and <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">--tags</span></code> options re2c uses efficient
submatch extraction algorithm described in the
<a class="reference external" href="https://arxiv.org/abs/1907.08837">Tagged Deterministic Finite Automata with Lookahead</a>
paper. The overhead on submatch extraction in the generated lexer grows with the
number of tags — if this number is moderate, the overhead is barely
noticeable. In the lexer tags are implemented using a number of tag variables
generated by re2c. There is no one-to-one correspondence between tag variables
and tags: a single variable may be reused for different tags, and one tag may
require multiple variables to hold all its ambiguous values. Eventually
ambiguity is resolved, and only one final variable per tag survives. When a rule
matches, all its tags are set to the values of the corresponding tag variables.
The exact number of tag variables is unknown to the user; this number is
determined by re2c. However, tag variables should be defined by the user as a
part of the lexer state and updated by <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code>, therefore re2c provides
directives <code class="docutils literal notranslate"><span class="pre">/*!stags:re2c*/</span></code> and <code class="docutils literal notranslate"><span class="pre">/*!mtags:re2c*/</span></code> that can be used to
declare, initialize and manipulate tag variables. These directives have two
optional configurations: <code class="docutils literal notranslate"><span class="pre">format</span> <span class="pre">=</span> <span class="pre">&quot;&#64;&#64;&quot;;</span></code> (specifies the template where <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code>
is substituted with the name of each tag variable), and <code class="docutils literal notranslate"><span class="pre">separator</span> <span class="pre">=</span> <span class="pre">&quot;&quot;;</span></code>
(specifies the piece of code used to join the generated pieces for different
tag variables).</p>
<p>S-tags support the following operations:</p>
<ul class="simple">
<li>save input position to an s-tag: <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">YYCURSOR</span></code> with default API or a
user-defined operation <code class="docutils literal notranslate"><span class="pre">YYSTAGP(t)</span></code> with generic API</li>
<li>save default value to an s-tag: <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">NULL</span></code> with default API or a
user-defined operation <code class="docutils literal notranslate"><span class="pre">YYSTAGN(t)</span></code> with generic API</li>
<li>copy one s-tag to another: <code class="docutils literal notranslate"><span class="pre">t1</span> <span class="pre">=</span> <span class="pre">t2</span></code></li>
</ul>
<p>M-tags support the following operations:</p>
<ul class="simple">
<li>append input position to an m-tag: a user-defined operation <code class="docutils literal notranslate"><span class="pre">YYMTAGP(t)</span></code>
with both default and generic API</li>
<li>append default value to an m-tag: a user-defined operation <code class="docutils literal notranslate"><span class="pre">YYMTAGN(t)</span></code>
with both default and generic API</li>
<li>copy one m-tag to another: <code class="docutils literal notranslate"><span class="pre">t1</span> <span class="pre">=</span> <span class="pre">t2</span></code></li>
</ul>
<p>S-tags can be implemented as scalar values (pointers or offsets). M-tags need a
more complex representation, as they need to store a sequence of tag values. The
most naive and inefficient representation of an m-tag is a list (array, vector)
of tag values; a more efficient representation is to store all m-tags in a
prefix-tree represented as array of nodes <code class="docutils literal notranslate"><span class="pre">(v,</span> <span class="pre">p)</span></code>, where <code class="docutils literal notranslate"><span class="pre">v</span></code> is tag value
and <code class="docutils literal notranslate"><span class="pre">p</span></code> is a pointer to parent node.</p>
<p>Here is an example of using s-tags to parse an IPv4 address.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">num</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">;</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">,</span> <span class="o">*</span><span class="n">o1</span><span class="p">,</span> <span class="o">*</span><span class="n">o2</span><span class="p">,</span> <span class="o">*</span><span class="n">o3</span><span class="p">,</span> <span class="o">*</span><span class="n">o4</span><span class="p">;</span>
    <span class="cm">/*!stags:re2c format = &#39;const char *@@;&#39;; */</span>

    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>
<span class="cm">    re2c:flags:tags = 1;</span>

<span class="cm">    oct = [0-9]{1,3};</span>
<span class="cm">    dot = [.];</span>

<span class="cm">    @o1 oct dot @o2 oct dot @o3 oct dot @o4 oct {</span>
<span class="cm">        return num(o4, YYCURSOR)</span>
<span class="cm">            + (num(o3, o4 - 1) &lt;&lt; 8)</span>
<span class="cm">            + (num(o2, o3 - 1) &lt;&lt; 16)</span>
<span class="cm">            + (num(o1, o2 - 1) &lt;&lt; 24);</span>
<span class="cm">    }</span>
<span class="cm">    * { return 0; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;1.2.3.4&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01020304</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x7f000001</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;255.255.255.255&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xffffffff</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is an example of using POSIX capturing groups to parse an IPv4 address.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">num</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">;</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*!maxnmatch:re2c*/</span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">yypmatch</span><span class="p">[</span><span class="n">YYMAXNMATCH</span><span class="p">];</span>
    <span class="kt">uint32_t</span> <span class="n">yynmatch</span><span class="p">;</span>
    <span class="cm">/*!stags:re2c format = &#39;const char *@@;&#39;; */</span>

    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>
<span class="cm">    re2c:flags:posix-captures = 1;</span>

<span class="cm">    oct = [0-9]{1,3};</span>
<span class="cm">    dot = [.];</span>

<span class="cm">    (oct) dot (oct) dot (oct) dot (oct) {</span>
<span class="cm">        return num(yypmatch[8], yypmatch[9])</span>
<span class="cm">            + (num(yypmatch[6], yypmatch[7]) &lt;&lt; 8)</span>
<span class="cm">            + (num(yypmatch[4], yypmatch[5]) &lt;&lt; 16)</span>
<span class="cm">            + (num(yypmatch[2], yypmatch[3]) &lt;&lt; 24);</span>
<span class="cm">    }</span>
<span class="cm">    * { return 0; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;1.2.3.4&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01020304</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x7f000001</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;255.255.255.255&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xffffffff</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is an example of using m-tags to parse a semicolon-separated sequence of
words (C++). Tag variables are stored in a tree that is packed in a vector.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ROOT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Mtag</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">pred</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tag</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Mtag</span><span class="o">&gt;</span> <span class="n">MtagTree</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">Words</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mtag</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">pt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">MtagTree</span> <span class="o">*</span><span class="n">tree</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Mtag</span> <span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="n">pt</span><span class="p">,</span> <span class="n">t</span><span class="p">};</span>
    <span class="o">*</span><span class="n">pt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tree</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
    <span class="n">tree</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">unfold</span><span class="p">(</span><span class="k">const</span> <span class="n">MtagTree</span> <span class="o">&amp;</span><span class="n">tree</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">Words</span> <span class="o">&amp;</span><span class="n">words</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">ROOT</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">unfold</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">pred</span><span class="p">,</span> <span class="n">tree</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">pred</span><span class="p">,</span> <span class="n">words</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">px</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tag</span><span class="p">,</span> <span class="o">*</span><span class="n">py</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">tag</span><span class="p">;</span>
    <span class="n">words</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span> <span class="o">-</span> <span class="n">px</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#define YYMTAGP(t) mtag(&amp;t, YYCURSOR, &amp;tree)</span>
<span class="cp">#define YYMTAGN(t) mtag(&amp;t, NULL,     &amp;tree)</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">,</span> <span class="n">Words</span> <span class="o">&amp;</span><span class="n">words</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>
    <span class="cm">/*!mtags:re2c format = &quot;int @@ = ROOT;&quot;; */</span>
    <span class="n">MtagTree</span> <span class="n">tree</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="cm">/*!re2c</span>
<span class="cm">    re2c:define:YYCTYPE = char;</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>
<span class="cm">    re2c:flags:tags = 1;</span>

<span class="cm">    (#x [a-zA-Z0-9_]+ #y [;])+ {</span>
<span class="cm">        words.clear();</span>
<span class="cm">        unfold(tree, x, y, words);</span>
<span class="cm">        return true;</span>
<span class="cm">    }</span>
<span class="cm">    * { return false; }</span>

<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Words</span> <span class="n">w</span><span class="p">;</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex</span><span class="p">(</span><span class="s">&quot;one;tw0;three;&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">==</span> <span class="n">Words</span><span class="p">({</span><span class="s">&quot;one&quot;</span><span class="p">,</span> <span class="s">&quot;tw0&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">}));</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="storable-state">
<h2>Storable state<a class="headerlink" href="#storable-state" title="Permalink to this headline">¶</a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">-f</span></code> <code class="docutils literal notranslate"><span class="pre">--storable-state</span></code> option re2c generates a lexer that can store
its current state, return to the caller, and later resume operations exactly
where it left off. The default mode of operation in re2c is a “pull” model,
in which the lexer “pulls” more input whenever it needs it. This may be
unacceptable in cases when the input becomes available piece by piece (for
example, if the lexer is invoked by the parser, or if the lexer program
communicates via a socket protocol with some other program that must wait for a
reply from the lexer before it transmits the next message). Storable state
feature is intended exactly for such cases: it allows to generate lexers that
work in a “push” model. When the lexer needs more input, it stores its state and
returns to the caller. Later, when more input becomes available, the caller
resumes the lexer exactly where it stopped. There are a few changes necessary
compared to the “pull” model:</p>
<ul class="simple">
<li>Define <code class="docutils literal notranslate"><span class="pre">YYSETSTATE()</span></code> and <code class="docutils literal notranslate"><span class="pre">YYGETSTATE(state)</span></code> promitives.</li>
<li>Define <code class="docutils literal notranslate"><span class="pre">yych</span></code>, <code class="docutils literal notranslate"><span class="pre">yyaccept</span></code> and <code class="docutils literal notranslate"><span class="pre">state</span></code> variables as a part of persistent
lexer state. The <code class="docutils literal notranslate"><span class="pre">state</span></code> variable should be initialized to <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> should return to the outer program instead of trying to supply more
input. Return code should indicate that lexer needs more input.</li>
<li>The outer program should recognize situations when lexer needs more input and
respond appropriately.</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">/*!getstate:re2c*/</span></code> directive if it is necessary to execute any code
before entering the lexer.</li>
<li>Use configurations <code class="docutils literal notranslate"><span class="pre">state:abort</span></code> and <code class="docutils literal notranslate"><span class="pre">state:nextlabel</span></code> to further tweak
the generated code.</li>
</ul>
<p>Here is an example of a “push”-model lexer that reads input from <code class="docutils literal notranslate"><span class="pre">stdin</span></code> and
expects a sequence of words separated by spaces and newlines. The lexer loops
forever, waiting for more input. It can be terminated by sending a special EOF
token — a word “stop”, in which case the lexer terminates successfully and
prints the number of words it has seen. Abnormal termination happens in case of
a syntax error, premature end of input (without the “stop” word) or in case the
buffer is too small to hold a lexeme (for example, if one of the words exceeds
buffer size). Premature end of input happens in case the lexer fails to read any
input while being in the initial state — this is the only case when EOF rule
matches. Note that the lexer may call <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> twice before terminating (and
thus require hitting <code class="docutils literal notranslate"><span class="pre">Ctrl+D</span></code> a few times). First time <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> is called
when the lexer expects continuation of the current greedy lexeme (either a word
or a whitespace sequence). If <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> fails, the lexer knows that it has
reached the end of the current lexeme and executes the corresponding semantic
action. The action jumps to the beginning of the loop, the lexer enters the
initial state and calls <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> once more. If it fails, the lexer matches EOF
rule. (Alternatively EOF rule can be used for termination instead of a special
EOF lexeme.)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#define SIZE 4096</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">lim</span><span class="p">,</span> <span class="o">*</span><span class="n">cur</span><span class="p">,</span> <span class="o">*</span><span class="n">tok</span><span class="p">,</span> <span class="n">yych</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">yyaccept</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">state</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Input</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">+</span> <span class="n">SIZE</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// append sentinel symbol</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">yych</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">yyaccept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">-</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">free</span> <span class="o">=</span> <span class="n">SIZE</span> <span class="o">-</span> <span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">-</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">free</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// not enough space in buffer</span>

    <span class="n">memmove</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span><span class="p">,</span> <span class="n">SIZE</span> <span class="o">-</span> <span class="n">shift</span><span class="p">);</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">-=</span> <span class="n">shift</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">-=</span> <span class="n">shift</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">-=</span> <span class="n">shift</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">read</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">free</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span> <span class="o">+=</span> <span class="n">read</span><span class="p">;</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// append sentinel symbol</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span><span class="n">OK</span><span class="p">,</span> <span class="n">SYNTAX_ERROR</span><span class="p">,</span> <span class="n">UNEXPECTED_EOF</span><span class="p">,</span> <span class="n">NEED_MORE_INPUT</span><span class="p">}</span> <span class="n">Status</span><span class="p">;</span>

<span class="cp">#define YYGETSTATE()  in-&gt;state</span>
<span class="cp">#define YYSETSTATE(s) in-&gt;state = s</span>
<span class="cp">#define YYFILL()      return NEED_MORE_INPUT</span>
<span class="k">static</span> <span class="n">Status</span> <span class="nf">lex</span><span class="p">(</span><span class="n">Input</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">*</span><span class="n">words</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*!getstate:re2c*/</span>
<span class="nl">loop</span><span class="p">:</span>
    <span class="n">in</span><span class="o">-&gt;</span><span class="n">tok</span> <span class="o">=</span> <span class="n">in</span><span class="o">-&gt;</span><span class="n">cur</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">        re2c:define:YYCTYPE = char;</span>
<span class="cm">        re2c:define:YYCURSOR = in-&gt;cur;</span>
<span class="cm">        re2c:define:YYLIMIT = in-&gt;lim;</span>
<span class="cm">        re2c:variable:yych = in-&gt;yych;</span>
<span class="cm">        re2c:eof = 0;</span>

<span class="cm">        *         { return SYNTAX_ERROR; }</span>
<span class="cm">        $         { return UNEXPECTED_EOF; }</span>
<span class="cm">        &quot;stop&quot;    { return OK; }</span>
<span class="cm">        [\n ]+    { goto loop; }</span>
<span class="cm">        [a-zA-Z]+ { *words = *words + 1; goto loop; }</span>
<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="n">words</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Input</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="k">const</span> <span class="n">Status</span> <span class="n">st</span> <span class="o">=</span> <span class="n">lex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">words</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">st</span> <span class="o">==</span> <span class="n">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;word count: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">words</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">st</span> <span class="o">==</span> <span class="n">SYNTAX_ERROR</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;error: unexpected symbol</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">st</span> <span class="o">==</span> <span class="n">UNEXPECTED_EOF</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;error: unexpected end of input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">fill</span><span class="p">(</span><span class="o">&amp;</span><span class="n">in</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;error: not enough space in buffer</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reusable-blocks">
<h2>Reusable blocks<a class="headerlink" href="#reusable-blocks" title="Permalink to this headline">¶</a></h2>
<p>Reuse mode is enabled with the <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">--reusable</span></code> option. In this mode re2c
allows to reuse definitions, configurations and rules specified by a
<code class="docutils literal notranslate"><span class="pre">/*!rules:re2c*/</span></code> block in subsequent <code class="docutils literal notranslate"><span class="pre">/*!use:re2c*/</span></code> blocks. As of
re2c-1.2 it is possible to mix such blocks with normal <code class="docutils literal notranslate"><span class="pre">/*!re2c*/</span></code> blocks;
prior to that re2c expects a single rules-block followed by use-blocks (normal
blocks are disallowed). Use-blocks can have additional definitions,
configurations and rules: they are merged to those specified by the rules-block.
A very common use case for <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">--reusable</span></code> option is a lexer that supports
multiple input encodings: lexer rules are defined once and reused multiple times
with encoding-specific configurations, such as <code class="docutils literal notranslate"><span class="pre">re2c:flags:utf-8</span></code>.</p>
<p>Below is an example of a multi-encoding lexer: it reads a phrase with Unicode
math symbols and accepts input either in UTF8 or in UT32. Note that the
<code class="docutils literal notranslate"><span class="pre">--input-encoding</span> <span class="pre">utf8</span></code> option allows us to write UTF8-encoded symbols in the
regular expressions; without this option re2c would parse them as a plain ASCII
byte sequnce (and we would have to use hexadecimal escape sequences).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>

<span class="cm">/*!rules:re2c</span>
<span class="cm">    re2c:yyfill:enable = 0;</span>

<span class="cm">    &quot;∀x ∃y: p(x, y)&quot; { return 0; }</span>
<span class="cm">    *                { return 1; }</span>
<span class="cm">*/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex_utf8</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>
    <span class="cm">/*!use:re2c</span>
<span class="cm">    re2c:define:YYCTYPE = uint8_t;</span>
<span class="cm">    re2c:flags:8 = 1;</span>
<span class="cm">    */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lex_utf32</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>
    <span class="cm">/*!use:re2c</span>
<span class="cm">    re2c:define:YYCTYPE = uint32_t;</span>
<span class="cm">    re2c:flags:8 = 0;</span>
<span class="cm">    re2c:flags:u = 1;</span>
<span class="cm">    */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">s8</span><span class="p">[]</span> <span class="o">=</span> <span class="c1">// UTF-8</span>
        <span class="p">{</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x79</span>
        <span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x29</span> <span class="p">};</span>

    <span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">s32</span><span class="p">[]</span> <span class="o">=</span> <span class="c1">// UTF32</span>
        <span class="p">{</span> <span class="mh">0x00002200</span><span class="p">,</span> <span class="mh">0x00000078</span><span class="p">,</span> <span class="mh">0x00000020</span><span class="p">,</span> <span class="mh">0x00002203</span>
        <span class="p">,</span> <span class="mh">0x00000079</span><span class="p">,</span> <span class="mh">0x0000003a</span><span class="p">,</span> <span class="mh">0x00000020</span><span class="p">,</span> <span class="mh">0x00000070</span>
        <span class="p">,</span> <span class="mh">0x00000028</span><span class="p">,</span> <span class="mh">0x00000078</span><span class="p">,</span> <span class="mh">0x0000002c</span><span class="p">,</span> <span class="mh">0x00000020</span>
        <span class="p">,</span> <span class="mh">0x00000079</span><span class="p">,</span> <span class="mh">0x00000029</span> <span class="p">};</span>

    <span class="n">assert</span><span class="p">(</span><span class="n">lex_utf8</span><span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">lex_utf32</span><span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
<div class="section" id="encoding-support">
<h2>Encoding support<a class="headerlink" href="#encoding-support" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">re2c</span></code> supports the following encodings: ASCII (default), EBCDIC (<code class="docutils literal notranslate"><span class="pre">-e</span></code>),
UCS-2 (<code class="docutils literal notranslate"><span class="pre">-w</span></code>), UTF-16 (<code class="docutils literal notranslate"><span class="pre">-x</span></code>), UTF-32 (<code class="docutils literal notranslate"><span class="pre">-u</span></code>) and UTF-8 (<code class="docutils literal notranslate"><span class="pre">-8</span></code>).
See also inplace configuration <code class="docutils literal notranslate"><span class="pre">re2c:flags</span></code>.</p>
<p>The following concepts should be clarified when talking about encodings.
A <em>code point</em> is an abstract number that represents a single symbol.
A <em>code unit</em> is the smallest unit of memory, which is used in the
encoded text (it corresponds to one character in the input stream). One
or more code units may be needed to represent a single code point,
depending on the encoding. In a <em>fixed-length</em> encoding, each code point
is represented with an equal number of code units. In <em>variable-length</em>
encodings, different code points can be represented with different number
of code units.</p>
<ul class="simple">
<li>ASCII is a fixed-length encoding. Its code space includes 0x100
code points, from 0 to 0xFF. A code point is represented with exactly one
1-byte code unit, which has the same value as the code point. The size of
<code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> must be 1 byte.</li>
<li>EBCDIC is a fixed-length encoding. Its code space includes 0x100
code points, from 0 to 0xFF. A code point is represented with exactly
one 1-byte code unit, which has the same value as the code point. The size
of <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> must be 1 byte.</li>
<li>UCS-2 is a fixed-length encoding. Its code space includes 0x10000
code points, from 0 to 0xFFFF. One code point is represented with
exactly one 2-byte code unit, which has the same value as the code
point. The size of <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> must be 2 bytes.</li>
<li>UTF-16 is a variable-length encoding. Its code space includes all
Unicode code points, from 0 to 0xD7FF and from 0xE000 to 0x10FFFF. One
code point is represented with one or two 2-byte code units. The size of
<code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> must be 2 bytes.</li>
<li>UTF-32 is a fixed-length encoding. Its code space includes all
Unicode code points, from 0 to 0xD7FF and from 0xE000 to 0x10FFFF. One
code point is represented with exactly one 4-byte code unit. The size of
<code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> must be 4 bytes.</li>
<li>UTF-8 is a variable-length encoding. Its code space includes all
Unicode code points, from 0 to 0xD7FF and from 0xE000 to 0x10FFFF. One
code point is represented with a sequence of one, two, three, or four
1-byte code units. The size of <code class="docutils literal notranslate"><span class="pre">YYCTYPE</span></code> must be 1 byte.</li>
</ul>
<p>In Unicode, values from range 0xD800 to 0xDFFF (surrogates) are not
valid Unicode code points. Any encoded sequence of code units that
would map to Unicode code points in the range 0xD800-0xDFFF, is
ill-formed. The user can control how <code class="docutils literal notranslate"><span class="pre">re2c</span></code> treats such ill-formed
sequences with the <code class="docutils literal notranslate"><span class="pre">--encoding-policy</span> <span class="pre">&lt;policy&gt;</span></code> switch.</p>
<p>For some encodings, there are code units that never occur in a valid
encoded stream (e.g., 0xFF byte in UTF-8). If the generated scanner must
check for invalid input, the only correct way to do so is to use the default
rule (<code class="docutils literal notranslate"><span class="pre">*</span></code>). Note that the full range rule (<code class="docutils literal notranslate"><span class="pre">[^]</span></code>) won’t catch invalid code units when a variable-length encoding is used
(<code class="docutils literal notranslate"><span class="pre">[^]</span></code> means “any valid code point”, whereas the default rule (<code class="docutils literal notranslate"><span class="pre">*</span></code>) means “any possible code unit”).</p>
</div>
<div class="section" id="start-conditions">
<h2>Start conditions<a class="headerlink" href="#start-conditions" title="Permalink to this headline">¶</a></h2>
<p><em>Conditions</em> are enabled with <code class="docutils literal notranslate"><span class="pre">-c</span></code> <code class="docutils literal notranslate"><span class="pre">--conditions</span></code>.
This option allows to encode multiple interrelated lexers within the same re2c block.</p>
<p>Each lexer corresponds to a single <em>condition</em>.
It starts with a label of the form <code class="docutils literal notranslate"><span class="pre">yyc_name</span></code>,
where <code class="docutils literal notranslate"><span class="pre">name</span></code> is <em>condition</em> name
and <code class="docutils literal notranslate"><span class="pre">yyc</span></code> prefix can be adjusted with configuration <code class="docutils literal notranslate"><span class="pre">re2c:condprefix</span></code>.
Different lexers are separated with a comment <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">***********************************</span> <span class="pre">*/</span></code>
which can be adjusted with configuration <code class="docutils literal notranslate"><span class="pre">re2c:cond:divider</span></code>.</p>
<p>Furthermore, each <em>condition</em> has a unique identifier of the form <code class="docutils literal notranslate"><span class="pre">yycname</span></code>,
where <code class="docutils literal notranslate"><span class="pre">name</span></code> is condition name
and <code class="docutils literal notranslate"><span class="pre">yyc</span></code> prefix can be adjusted with configuration <code class="docutils literal notranslate"><span class="pre">re2c:condenumprefix</span></code>.
Identifiers have the type <code class="docutils literal notranslate"><span class="pre">YYCONDTYPE</span></code> and should be generated with <code class="docutils literal notranslate"><span class="pre">/*!types:re2c*/</span></code> directive or <code class="docutils literal notranslate"><span class="pre">-t</span></code> <code class="docutils literal notranslate"><span class="pre">--type-header</span></code> option.
Users shouldn’t define these identifiers manually, as the order of <em>conditions</em> is not specified.</p>
<p>Before all <em>conditions</em> re2c generates entry code that checks the current <em>condition</em> identifier
and transfers control flow to the start label of the active <em>condition</em>.
After matching some rule of this <em>condition</em>,
lexer may either transfer control flow back to the entry code (after executing the associated action and optionally setting another <em>condition</em> with <code class="docutils literal notranslate"><span class="pre">=&gt;</span></code>),
or use <code class="docutils literal notranslate"><span class="pre">:=&gt;</span></code> shortcut and transition directly to the start label of another <em>condition</em> (skipping the action and the entry code).
Configuration <code class="docutils literal notranslate"><span class="pre">re2c:cond:goto</span></code> allows to change the default behavior.</p>
<p>Syntactically each rule must be preceded with a list of comma-separated <em>condition</em> names or a wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code>
enclosed in angle brackets <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>.
Wildcard means “any condition” and is semantically equivalent to listing all condition names.
Here <code class="docutils literal notranslate"><span class="pre">regexp</span></code> is a regular expression, <code class="docutils literal notranslate"><span class="pre">default</span></code> refers to the <em>default rule</em> <code class="docutils literal notranslate"><span class="pre">*</span></code>,
and <code class="docutils literal notranslate"><span class="pre">action</span></code> is a block of C/C++ code.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;conditions-or-wildcard&gt;</span>&#160; <span class="pre">regexp-or-default</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">action</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;conditions-or-wildcard&gt;</span>&#160; <span class="pre">regexp-or-default</span>&#160; <span class="pre">=&gt;</span>&#160; <span class="pre">condition</span>&#160; <span class="pre">action</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;conditions-or-wildcard&gt;</span>&#160; <span class="pre">regexp-or-default</span>&#160; <span class="pre">:=&gt;</span> <span class="pre">condition</span></code></li>
</ul>
<p>Rules with an exclamation mark <code class="docutils literal notranslate"><span class="pre">!</span></code> in front of condition list have a special meaning:
they have no regular expression,
and the associated action is merged as an entry code to actions of normal rules.
This might be a convenient place to peform a routine task that is common to all rules.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;!conditions-or-wildcard&gt;</span>&#160; <span class="pre">action</span></code></li>
</ul>
<p>Another special form of rules with an empty condition list <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code> and no regular expression
allows to specify an “entry condition” that can be used to execute code before entering the lexer.
It is semantically equivalent to a condition with number zero, name <code class="docutils literal notranslate"><span class="pre">0</span></code> and an empty regular expression.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">action</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span>&#160; <span class="pre">=&gt;</span>&#160; <span class="pre">condition</span>&#160; <span class="pre">action</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span>&#160; <span class="pre">:=&gt;</span> <span class="pre">condition</span></code></li>
</ul>
</div>
<div class="section" id="skeleton-programs">
<h2>Skeleton programs<a class="headerlink" href="#skeleton-programs" title="Permalink to this headline">¶</a></h2>
<p>With the <code class="docutils literal notranslate"><span class="pre">-S,</span> <span class="pre">--skeleton</span></code> option, re2c ignores all non-re2c code and generates
a self-contained C program that can be further compiled and executed. The
program consists of lexer code and input data. For each constructed DFA (block
or condition) re2c generates a standalone lexer and two files: an <code class="docutils literal notranslate"><span class="pre">.input</span></code>
file with strings derived from the DFA and a <code class="docutils literal notranslate"><span class="pre">.keys</span></code> file with expected match
results. The program runs each lexer on the corresponding <code class="docutils literal notranslate"><span class="pre">.input</span></code> file and
compares results with the expectations.
Skeleton programs are very useful for a number of reasons:</p>
<ul class="simple">
<li>They can check correctness of various re2c optimizations (the data is
generated early in the process, before any DFA transformations have taken
place).</li>
<li>Generating a set of input data with good coverage may be useful for both
testing and benchmarking.</li>
<li>Generating self-contained executable programs allows to get minimized test
cases (the original code may be large or have a lot of dependencies).</li>
</ul>
<p>The difficulty with generating input data is that for all but the most trivial
cases the number of possible input strings is too large (even if the string
length is limited). Re2c solves this difficulty by generating sufficiently
many strings to cover almost all DFA transitions. It uses the following
algorithm. First, it constructs a skeleton of the DFA. For encodings with 1-byte
code unit size (such as ASCII, UTF-8 and EBCDIC) skeleton is just an exact copy
of the original DFA. For encodings with multibyte code units skeleton is a copy
of DFA with certain transitions omitted: namely, re2c takes at most 256 code
units for each disjoint continuous range that corresponds to a DFA transition.
The chosen values are evenly distributed and include range bounds. Instead of
trying to cover all possible paths in the skeleton (which is infeasible) re2c
generates sufficiently many paths to cover all skeleton transitions, and thus
trigger the corresponding conditional jumps in the lexer.
The algorithm implementation is limited by ~1Gb of transitions and consumes
constant amount of memory (re2c writes data to file as soon as it is generated).</p>
<p>Here is an example of a very simple program
<a class="reference download internal" href="../_downloads/example.re.txt" download=""><code class="xref download docutils literal notranslate"><span class="pre">[example.re]</span></code></a>
that tries to match two-digit hexadecimal numbers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    *              {}</span>
<span class="cm">    [0-9a-fA-F]{2} {}</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>We can see the generated DFA using <code class="docutils literal notranslate"><span class="pre">`re2c</span> <span class="pre">-D</span> <span class="pre">example.re</span> <span class="pre">|</span> <span class="pre">dot</span> <span class="pre">-Grankdir=LR</span> <span class="pre">-Tpng</span> <span class="pre">-o</span> <span class="pre">example.png`</span></code>:</p>
<a class="reference internal image-reference" href="../_images/example.png"><img alt="../_images/example.png" src="../_images/example.png" style="width: 60%;" /></a>
<p>Given this program, <code class="docutils literal notranslate"><span class="pre">`re2c</span> <span class="pre">-S</span> <span class="pre">-o</span> <span class="pre">example.c</span> <span class="pre">example.re`</span></code> generates three files:
<code class="docutils literal notranslate"><span class="pre">example.c</span></code> (main program), <code class="docutils literal notranslate"><span class="pre">example.c.line4.input</span></code> (input data) and <code class="docutils literal notranslate"><span class="pre">example.c.line4.keys</span></code> (expected match results).
First, let’s look at the generated strings
<a class="reference download internal" href="../_downloads/example.c.line4.input" download=""><code class="xref download docutils literal notranslate"><span class="pre">[example.c.line4.input]</span></code></a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ hexdump -v -e &#39;&quot;%08_ax &quot; 24/1 &quot;%02x &quot;&#39; -e &#39;&quot; |&quot; 24/1 &quot;%_p&quot; &quot;|\n&quot;&#39; example.c.line4.input
00000000 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 |........................|
00000018 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f |........ !&quot;#$%&amp;&#39;()*+,-./|
00000030 3a 3b 3c 3d 3e 3f 40 47 48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 |:;&lt;=&gt;?@GHIJKLMNOPQRSTUVW|
[ ... ]
</pre></div>
</div>
<p>Byte sequences correspond to the paths in DFA.
All strings are glued together, so it’s hard to tell where is the end of one string and the beginning of another.
For that re2c generates keys <a class="reference download internal" href="../_downloads/example.c.line4.keys" download=""><code class="xref download docutils literal notranslate"><span class="pre">[example.c.line4.keys]</span></code></a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$hexdump -v -e &#39;&quot;%08_ax &quot; 36/1 &quot;%02x &quot; &quot;\n&quot;&#39; example.c.line4.keys
00000000 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe
00000024 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe
00000048 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe 01 01 fe
[ ... ]
</pre></div>
</div>
<p>A key is a triplet: string length, the length of matching prefix and the number of matching rule.
(If tags are used, there is an additional key per each tag variable).
Keys are packed into an array.
In our case each key fits into 1 byte, but in case of a larger DFA they might take 2 or 4 bytes.
The generated program <a class="reference download internal" href="../_downloads/example.c.txt" download=""><code class="xref download docutils literal notranslate"><span class="pre">[example.c]</span></code></a>
contains two auxilary functions: <code class="docutils literal notranslate"><span class="pre">read_file</span></code> and <code class="docutils literal notranslate"><span class="pre">action_line4</span></code>.
<code class="docutils literal notranslate"><span class="pre">read_file</span></code> is used to map <code class="docutils literal notranslate"><span class="pre">.input</span></code> and <code class="docutils literal notranslate"><span class="pre">.keys</span></code> files into memory (this function is shared between all lexers).
<code class="docutils literal notranslate"><span class="pre">action_line4</span></code> is a replacement for actions: it compares actual lexing results with the expected results.
This function is specific to each lexer.
Lexing is done by <code class="docutils literal notranslate"><span class="pre">lex_line4</span></code>: this function contains the generated DFA.
The skeleton program is self-contained, so we can compile and run it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cc -o example example.c
$ ./example
$ echo $?
0
</pre></div>
</div>
<p>When everything is fine (there are no errors) the program outputs nothing and
exits with zero. For the sake of example, let’s pretend that re2c has an error
that results in a missing <code class="docutils literal notranslate"><span class="pre">case</span></code> statement:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ re2c -S -o example.c example.re
$ sed -i -e <span class="s2">&quot;s/case &#39;7&#39;://&quot;</span> example.c
$ cc -o example example.c
$ ./example
error: lex_line4: at position <span class="m">248</span> <span class="o">(</span>iteration <span class="m">241</span><span class="o">)</span>:
        expected: match length <span class="m">2</span>, rule <span class="m">0</span>
        actual:   match length <span class="m">1</span>, rule <span class="m">254</span>
</pre></div>
</div>
<p>Viola! Now the lexer complains about discrepancy between expected and actual
match results.</p>
<p>One special case of failure detected by skeleton programs is undefined control
flow in the lexer. Use <code class="docutils literal notranslate"><span class="pre">-Wundefined-control-flow</span></code> warning to catch all such
cases in in your code (more details <a class="reference external" href="/manual/manual.html#wundefined-control-flow">here</a>).</p>
</div>
<div class="section" id="visualization-and-debug">
<h2>Visualization and debug<a class="headerlink" href="#visualization-and-debug" title="Permalink to this headline">¶</a></h2>
<p>With the <code class="docutils literal notranslate"><span class="pre">-D,</span> <span class="pre">--emit-dot</span></code> option, re2c does not generate C/C++ code. Instead,
it dumps the generated DFA in the
<a class="reference external" href="https://en.wikipedia.org/wiki/DOT_%28graph_description_language%29">DOT format</a>.
One can convert this dump to an image of the DFA using
<a class="reference external" href="http://www.graphviz.org/">graphviz</a> or another library.
Note that this option shows the final DFA after it has gone through a number of
optimizations and transformations. Earlier stages can be dumped with various debug
options, such as <code class="docutils literal notranslate"><span class="pre">--dump-nfa</span></code>, <code class="docutils literal notranslate"><span class="pre">--dump-dfa-raw</span></code> etc. (see the full
<a class="reference external" href="/manual/manual.html#command-line-options">list of options</a>).</p>
<p>Below is an example of generating a picture of DFA that accepts any UTF-8 code point
(<code class="docutils literal notranslate"><span class="pre">utf8_any.re</span></code>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    *   {}</span>
<span class="cm">    [^] {}</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>Generate and render:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -D -8 utf8_any.re | dot -Tpng -o utf8_any.png
</pre></div>
</div>
<p>Here is the picture:</p>
<a class="reference internal image-reference" href="../_images/utf8_any.png"><img alt="../_images/utf8_any.png" src="../_images/utf8_any.png" style="width: 90%;" /></a>
</div>
<div class="section" id="warnings">
<h2>Warnings<a class="headerlink" href="#warnings" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-W</span></code></dt>
<dd>Turn on all warnings.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Werror</span></code></dt>
<dd>Turn warnings into errors. Note that this option alone
doesn’t turn on any warnings; it only affects those warnings that have
been turned on so far or will be turned on later.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-W&lt;warning&gt;</span></code></dt>
<dd>Turn on <code class="docutils literal notranslate"><span class="pre">warning</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wno-&lt;warning&gt;</span></code></dt>
<dd>Turn off <code class="docutils literal notranslate"><span class="pre">warning</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Werror-&lt;warning&gt;</span></code></dt>
<dd>Turn on <code class="docutils literal notranslate"><span class="pre">warning</span></code> and treat it as an error (this implies <code class="docutils literal notranslate"><span class="pre">-W&lt;warning&gt;</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wno-error-&lt;warning&gt;</span></code></dt>
<dd>Don’t treat this particular <code class="docutils literal notranslate"><span class="pre">warning</span></code> as an error. This doesn’t turn off
the warning itself.</dd>
</dl>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-Wcondition-order</span></code></dt>
<dd>Warn if the generated program makes implicit
assumptions about condition numbering. One should use either the <code class="docutils literal notranslate"><span class="pre">-t,</span> <span class="pre">--type-header</span></code> option or
the <code class="docutils literal notranslate"><span class="pre">/*!types:re2c*/</span></code> directive to generate a mapping of condition names to numbers and then use
the autogenerated condition names.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wempty-character-class</span></code></dt>
<dd>Warn if a regular expression contains an empty
character class. Trying to match an empty character class makes no sense: it should always fail.
However, for backwards compatibility reasons <code class="docutils literal notranslate"><span class="pre">re2c</span></code> allows empty character classes and
treats them as empty strings. Use the <code class="docutils literal notranslate"><span class="pre">--empty-class</span></code> option to change the default
behavior.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wmatch-empty-string</span></code></dt>
<dd>Warn if a rule is nullable (matches an empty string).
If the lexer runs in a loop and the empty match is unintentional,
the lexer may unexpectedly hang in an infinite loop.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wswapped-range</span></code></dt>
<dd>Warn if the lower bound of a range is greater than its upper
bound. The default behavior is to silently swap the range bounds.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wundefined-control-flow</span></code></dt>
<dd>Warn if some input strings cause undefined
control flow in the lexer (the faulty patterns are reported). This is the
most dangerous and most common mistake. It can be easily fixed by adding
the default rule <code class="docutils literal notranslate"><span class="pre">*</span></code> which has the lowest priority, matches any code unit, and consumes
exactly one code unit.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wunreachable-rules</span></code></dt>
<dd>Warn about rules that are shadowed by other rules and will never match.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wuseless-escape</span></code></dt>
<dd>Warn if a symbol is escaped when it shouldn’t be.
By default, re2c silently ignores such escapes, but this may as well indicate a
typo or an error in the escape sequence.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-Wnondeterministic-tags</span></code></dt>
<dd>Warn if a tag has <code class="docutils literal notranslate"><span class="pre">n</span></code>-th degree of nondeterminism, where <code class="docutils literal notranslate"><span class="pre">n</span></code> is greater than 1.</dd>
</dl>
<div class="section" id="wundefined-control-flow">
<h3>[-Wundefined-control-flow]<a class="headerlink" href="#wundefined-control-flow" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">-Wundefined-control-flow</span></code> warning re2c checks that every path in the
generated DFA contains at least one accepting state. When the input matches
such a path, lexer will eventually stop and execute the corresponding semantic
action. However, if some path has no accepting state, then lexer behavior is
undefined: it may loop forever, or read past the end of buffer, or jump to some
other semantic action by accident. For example, consider this simple piece of
code (a.re) that is supposed to match letter <code class="docutils literal notranslate"><span class="pre">a</span></code>:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    &quot;a&quot; { return &#39;a&#39;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>The generated code looks like this:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">YYCTYPE</span> <span class="n">yych</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">YYLIMIT</span> <span class="o">&lt;=</span> <span class="n">YYCURSOR</span><span class="p">)</span> <span class="n">YYFILL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">yych</span> <span class="o">=</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">yych</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">&#39;a&#39;</span><span class="o">:</span>       <span class="k">goto</span> <span class="n">yy3</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>        <span class="k">goto</span> <span class="n">yy2</span><span class="p">;</span>
        <span class="p">}</span>
<span class="nl">yy2</span><span class="p">:</span>
<span class="nl">yy3</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="p">{</span> <span class="k">return</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Clearly this is not what we want: this code matches any letter, not just <code class="docutils literal notranslate"><span class="pre">a</span></code>!
This happens because we did not specify any handler for the remaining input symbols.
If we run re2c with <code class="docutils literal notranslate"><span class="pre">-Wundefined-control-flow</span></code>, we will see that it complains about undefined control flow and recommends using default rule <code class="docutils literal notranslate"><span class="pre">*</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>a.re:3:2: warning: control flow is undefined for strings that match &#39;[\x0-\x60\x62-\xFF]&#39;, use the default &#39;*&#39; rule  [-Wundefined-control-flow]
</pre></div>
</div>
<p>Let’s follow the advice and change the code:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    *   { return &#39;*&#39;; }</span>
<span class="cm">    &quot;a&quot; { return &#39;a&#39;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>Now the generated code looks much better:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">YYCTYPE</span> <span class="n">yych</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">YYLIMIT</span> <span class="o">&lt;=</span> <span class="n">YYCURSOR</span><span class="p">)</span> <span class="n">YYFILL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">yych</span> <span class="o">=</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">yych</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">&#39;a&#39;</span><span class="o">:</span>       <span class="k">goto</span> <span class="n">yy4</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>        <span class="k">goto</span> <span class="n">yy2</span><span class="p">;</span>
        <span class="p">}</span>
<span class="nl">yy2</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="p">{</span> <span class="k">return</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="nl">yy4</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="p">{</span> <span class="k">return</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Note that the default rule brings no overhead: it simply binds code to the
default label. It should always be used, unless you are absolutely sure that
your grammar covers all possible cases.</p>
<div class="section" id="the-old-default-rule">
<h4>The old default rule<a class="headerlink" href="#the-old-default-rule" title="Permalink to this headline">¶</a></h4>
<p>When the world was young and re2c didn’t have the default <code class="docutils literal notranslate"><span class="pre">*</span></code> rule (that is,
before re2c-0.13.7) everyone used <code class="docutils literal notranslate"><span class="pre">[^]</span></code> as the default rule, as in this
example (any.re):</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    // ... normal rules ...</span>
<span class="cm">    [^] { return &quot;any&quot;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">[^]</span></code> is just an ordinary rule: it matches any character and has normal
priority (so it should be the last rule). If other rules didn’t match, <code class="docutils literal notranslate"><span class="pre">[^]</span></code>
will match and consume one character.</p>
<p>But exactly what is a <em>character</em>? First, an abstract number that is assigned
some sacred meaning within the current encoding — a <em>code point</em>. Second, a
minimal piece of information (say, combination of bits) that can represent a
unit of encoded text — a <em>code unit</em>. Rules are defined in terms of code points.
Input is measured in code units. In fixed-width encodings (such as ASCII,
EBCDIC, UCS-2, UTF-32, etc.), there is a one-to-one correspondence between code
points and code units. In variable-width encodings (such as UTF-8, UTF-16,
etc.), code points map to code unit sequences of different lengths.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">[^]</span></code> rule matches any code point. In fixed-width encodings, it covers all
code units and consumes exactly one of them. In variable-width encodings, it
consumes variable number of code units and may not match some of them. The
example above compiles without warnings with any fixed-width encoding (ASCII by
default). However, with the UTF-8 encoding
<code class="docutils literal notranslate"><span class="pre">`re2c</span> <span class="pre">-i8</span> <span class="pre">-Wundefined-control-flow</span> <span class="pre">any.re`</span></code> complains:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>any.re:4:2: warning: control flow is undefined for strings that match
        &#39;[\x80-\xC1\xF5-\xFF]&#39;
        &#39;\xF0 [\x0-\x8F\xC0-\xFF]&#39;
        &#39;[\xE1-\xEF] [\x0-\x7F\xC0-\xFF]&#39;
        &#39;\xF4 [\x0-\x7F\x90-\xFF]&#39;
        &#39;\xE0 [\x0-\x9F\xC0-\xFF]&#39;
        &#39;[\xF1-\xF3] [\x0-\x7F\xC0-\xFF]&#39;
        &#39;[\xC2-\xDF] [\x0-\x7F\xC0-\xFF]&#39;
        &#39;\xE0 [\xA0-\xBF] [\x0-\x7F\xC0-\xFF]&#39;
 ... and 7 more, use default rule &#39;*&#39; [-Wundefined-control-flow]
</pre></div>
</div>
<p>It shows us the patterns that must never appear in valid UTF-8 encoded text. If
the input is not valid UTF-8, lexer behavior is undefined. One would expect that
with UTF-16 (another variable-width encoding), re2c would also report a warning,
but it doesn’t. This is because by default, re2c treats Unicode surrogates as
normal code points (for backwards compatibility reasons). If we tell re2c to
exclude surrogates
(<code class="docutils literal notranslate"><span class="pre">`re2c</span> <span class="pre">-ix</span> <span class="pre">--encoding-policy</span> <span class="pre">fail</span> <span class="pre">-Wundefined-control-flow`</span></code>), then we will
get a warning:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>any.re:4:2: warning: control flow is undefined for strings that match
        &#39;[\xDC00-\xDFFF]&#39;
        &#39;[\xD800-\xDBFF] [\x0-\xDBFF\xE000-\xFFFF]&#39;
, use default rule &#39;*&#39; [-Wundefined-control-flow]
</pre></div>
</div>
<p>As you see, it can get quite subtle. A good advice is, always use default rule
<code class="docutils literal notranslate"><span class="pre">*</span></code>: it  matches any code unit regardless of encoding, consumes a single code
unit no matter what and always has the lowest priority. Note that <code class="docutils literal notranslate"><span class="pre">*</span></code> is a
built-in hack: it cannot be expressed through ordinary rules.</p>
</div>
</div>
<div class="section" id="wunreachable-rules">
<h3>[-Wunreachable-rules]<a class="headerlink" href="#wunreachable-rules" title="Permalink to this headline">¶</a></h3>
<p>Sometimes the input grammar contains rules that will never match. This can
happen for two reasons. First, some rules may be shadowed by other rules that
match the same input, but have higher priority. Second, the rule itself may be
infinitely greedy: it may consume as many input characters as it can get and
never stop, and as a result never match. Both cases indicate a problem with
the grammar, and <code class="docutils literal notranslate"><span class="pre">-Wunreachable-rules</span></code> detects and reports such rules.</p>
<p>Let’s see an example of the first kind: shadowed rules (shadowed.re).</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    &quot;&quot;          { return &quot;&quot;; }</span>
<span class="cm">    *           { return &quot;*&quot;; }</span>
<span class="cm">    &quot;a&quot; | &quot;b&quot;   { return &quot;a | b&quot;; }</span>
<span class="cm">    &quot;a&quot;         { return &quot;a&quot;; }</span>
<span class="cm">    [\x00-\xFF] { return &quot;[0 - 0xFF]&quot;; }</span>
<span class="cm">    [^]         { return &quot;[^]&quot;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>In this example the empty rule <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> never matches, because any single code
unit is matched by other rules, which take precedence due to the longerst match.
Rule <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> is shadowed by rule <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span> <span class="pre">|</span> <span class="pre">&quot;b&quot;</span></code>, which also matches <code class="docutils literal notranslate"><span class="pre">a</span></code>, but
takes precedence because it comes first. Similarly, rule <code class="docutils literal notranslate"><span class="pre">[^]</span></code> is shadowed by
rule <code class="docutils literal notranslate"><span class="pre">[\x00-\xFF]</span></code>. Default rule <code class="docutils literal notranslate"><span class="pre">*</span></code> is also shadowed, but it’s an exception
that is not reported (default case should always be handled). Shadowed rules
normally do not appear in the generated code: re2c removes them during its dead
code elimination pass.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -Wunreachable-rules shadowed.re -o shadowed.c
shadowed.re:2:16: warning: unreachable rule (shadowed by rules at lines 4, 6) [-Wunreachable-rules]
shadowed.re:5:16: warning: unreachable rule (shadowed by rule at line 4) [-Wunreachable-rules]
shadowed.re:7:16: warning: unreachable rule (shadowed by rules at lines 4, 6) [-Wunreachable-rules]
</pre></div>
</div>
<p>Now let’s see an example of second kind: infinitely greedy rule (greedy.re).</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    [^]* { return &quot;greeedy&quot;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>This rule will continue eating input characters until <code class="docutils literal notranslate"><span class="pre">YYFILL</span></code> fails, or until
it reads past the end of buffer and causes memory access violation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -Wunreachable-rules greedy.re -o greedy.c
greedy.re:2:9: warning: unreachable rule  [-Wunreachable-rules]
</pre></div>
</div>
</div>
<div class="section" id="wcondition-order">
<h3>[-Wcondition-order]<a class="headerlink" href="#wcondition-order" title="Permalink to this headline">¶</a></h3>
<p>Some older re2c programs that use <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">--conditions</span></code> option rely on a fixed
condition order instead of using <code class="docutils literal notranslate"><span class="pre">/*!types:re2c*/</span></code> directive or the
<code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">--type-header</span></code> option. This is incorrect and dangerous, as demonstrated by
the following example <a class="reference download internal" href="../_downloads/fixorder.re.txt" download=""><code class="xref download docutils literal notranslate"><span class="pre">[fixorder.re]</span></code></a>. In this example
the lexer has two conditions: <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>. It starts in condition <code class="docutils literal notranslate"><span class="pre">a</span></code>,
which expects a sequence of letters <code class="docutils literal notranslate"><span class="pre">a</span></code> followed by a comma. The comma causes
transition to condition <code class="docutils literal notranslate"><span class="pre">b</span></code>, which expects a sequence of letters <code class="docutils literal notranslate"><span class="pre">b</span></code>
followed by an exclamation mark. Anything other input is an error. Nothing
special, except that condition numbers are hardcoded manually (the mapping of
conditions to numbers is toggled by <code class="docutils literal notranslate"><span class="pre">REVERSED_CONDITION_ORDER</span></code> define).</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cp">#ifdef REVERSED_CONDITION_ORDER</span>
<span class="cp">#    define yyca 1</span>
<span class="cp">#    define yycb 0</span>
<span class="cp">#else</span>
<span class="cp">#    define yyca 0</span>
<span class="cp">#    define yycb 1</span>
<span class="cp">#endif</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">YYCURSOR</span> <span class="o">=</span> <span class="s">&quot;aaaa,bbb!&quot;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">yyca</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
    <span class="cm">/*!re2c</span>
<span class="cm">        re2c:define:YYCTYPE = char;</span>
<span class="cm">        re2c:yyfill:enable = 0;</span>
<span class="cm">        re2c:define:YYSETCONDITION = &quot;c = @@;&quot;;</span>
<span class="cm">        re2c:define:YYSETCONDITION:naked = 1;</span>
<span class="cm">        re2c:define:YYGETCONDITION = c;</span>
<span class="cm">        re2c:define:YYGETCONDITION:naked = 1;</span>

<span class="cm">        &lt;*&gt; * { printf (&quot;error\n&quot;); break; }</span>

<span class="cm">        &lt;a&gt; &quot;a&quot;      { printf (&quot;a&quot;); continue; }</span>
<span class="cm">        &lt;a&gt; &quot;,&quot; =&gt; b { printf (&quot;,&quot;); continue; }</span>

<span class="cm">        &lt;b&gt; &quot;!&quot; { printf (&quot;!\n&quot;); break; }</span>
<span class="cm">        &lt;b&gt; &quot;b&quot; { printf (&quot;b&quot;); continue; }</span>
<span class="cm">    */</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Let’s compile and run it.
Everything works fine: we get <code class="docutils literal notranslate"><span class="pre">aaaa,bbb!</span></code> in both cases.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -c -o fixorder.c -Wcondition-order fixorder.re
$
$ c++ -o fixorder fixorder.c &amp;&amp; ./fixorder
aaaa,bbb!
$
$ c++ -o fixorder fixorder.c -DREVERSED_CONDITION_ORDER &amp;&amp; ./fixorder
aaaa,bbb!
</pre></div>
</div>
<p>However, if we use the <code class="docutils literal notranslate"><span class="pre">-s</span></code> re2c option, the lexer becomes sensitive to condition order:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -cs -o fixorder.c -Wcondition-order fixorder.re
fixorder.re:31:6: warning: looks like you use hardcoded numbers instead of autogenerated condition names:
better add &#39;/*!types:re2c*/&#39; directive or &#39;-t, --type-header&#39; option and don&#39;t rely on fixed condition order. [-Wcondition-order]
$
$ c++ -o fixorder fixorder.c &amp;&amp; ./fixorder
aaaa,bbb!
$
$ c++ -o fixorder fixorder.c -DREVERSED_CONDITION_ORDER &amp;&amp; ./fixorder
error
</pre></div>
</div>
<p>And we get a warning from re2c. The same behavior remains if we use <code class="docutils literal notranslate"><span class="pre">-g</span></code> or
<code class="docutils literal notranslate"><span class="pre">-b</span></code> option. Why is that? A look at the generated code explains everything.
By default the initial dispatch on conditions is a <code class="docutils literal notranslate"><span class="pre">switch</span></code> statement:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="nl">yyca</span><span class="p">:</span> <span class="k">goto</span> <span class="n">yyc_a</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">yycb</span><span class="p">:</span> <span class="k">goto</span> <span class="n">yyc_b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dispatch uses explicit condition names and works no matter what numbers are assigned to them.
However, with the <code class="docutils literal notranslate"><span class="pre">-s</span></code> option, re2c generates an <code class="docutils literal notranslate"><span class="pre">if</span></code> statement instead of a <code class="docutils literal notranslate"><span class="pre">switch</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">yyc_a</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">yyc_b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And with the <code class="docutils literal notranslate"><span class="pre">-g</span></code> option, it uses a jump table (computed <code class="docutils literal notranslate"><span class="pre">goto</span></code>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="o">*</span><span class="n">yyctable</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">&amp;&amp;</span><span class="n">yyc_a</span><span class="p">,</span>
        <span class="o">&amp;&amp;</span><span class="n">yyc_b</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">goto</span> <span class="o">*</span><span class="n">yyctable</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
</pre></div>
</div>
<p>The last two cases are sensitive to condition order. The fix is easy: as the
warning suggests, use the <code class="docutils literal notranslate"><span class="pre">/*!types:re2c*/</span></code> directive or the
<code class="docutils literal notranslate"><span class="pre">-t,</span> <span class="pre">--type-header</span></code> option.</p>
</div>
<div class="section" id="wuseless-escape">
<h3>[-Wuseless-escape]<a class="headerlink" href="#wuseless-escape" title="Permalink to this headline">¶</a></h3>
<p>Sometimes people escape characters that don’t need to be escaped — either
because they (mistakenly) think that the character is special and must be
escaped in the given context, or because they think that this escape sequence
means something (when it actually doesn’t), or just by pure accident. With
<code class="docutils literal notranslate"><span class="pre">-Wuseless-escape</span></code> option re2c warns about ignored escapes. Consider this
example (escapes.re):</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    *                        {}</span>
<span class="cm">    &quot;\a\A\&quot;\&#39;\[\]\-\x5d\377&quot; {}</span>
<span class="cm">    &#39;\a\A\&quot;\&#39;\[\]\-\x5d\377&#39; {}</span>
<span class="cm">    [\a\A\&quot;\&#39;\[\]\-\x5d\377] {}</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>Re2c reports a bunch of warnings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -Wuseless-escape escapes.re -o escapes.c
escapes.re:3:7: warning: escape has no effect: &#39;\A&#39; [-Wuseless-escape]
escapes.re:3:11: warning: escape has no effect: &#39;\&#39;&#39; [-Wuseless-escape]
escapes.re:3:13: warning: escape has no effect: &#39;\[&#39; [-Wuseless-escape]
escapes.re:3:15: warning: escape has no effect: &#39;\]&#39; [-Wuseless-escape]
escapes.re:3:17: warning: escape has no effect: &#39;\-&#39; [-Wuseless-escape]
escapes.re:4:7: warning: escape has no effect: &#39;\A&#39; [-Wuseless-escape]
escapes.re:4:9: warning: escape has no effect: &#39;\&quot;&#39; [-Wuseless-escape]
escapes.re:4:13: warning: escape has no effect: &#39;\[&#39; [-Wuseless-escape]
escapes.re:4:15: warning: escape has no effect: &#39;\]&#39; [-Wuseless-escape]
escapes.re:4:17: warning: escape has no effect: &#39;\-&#39; [-Wuseless-escape]
escapes.re:5:7: warning: escape has no effect: &#39;\A&#39; [-Wuseless-escape]
escapes.re:5:9: warning: escape has no effect: &#39;\&quot;&#39; [-Wuseless-escape]
escapes.re:5:11: warning: escape has no effect: &#39;\&#39;&#39; [-Wuseless-escape]
escapes.re:5:13: warning: escape has no effect: &#39;\[&#39; [-Wuseless-escape]
</pre></div>
</div>
<p>This is because the <code class="docutils literal notranslate"><span class="pre">\A</span></code> and <code class="docutils literal notranslate"><span class="pre">\[</span></code> escapes are meaningless in all rules,
<code class="docutils literal notranslate"><span class="pre">\-</span></code> makes sense only in a character class,
and each type of closing quotes (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">'</span></code> and <code class="docutils literal notranslate"><span class="pre">]</span></code>) should only be escaped inside of a string delimited with the same quotes.
Useless escapes are ignored: the escaped symbol is treated as not escaped (<code class="docutils literal notranslate"><span class="pre">\A</span></code> becomes <code class="docutils literal notranslate"><span class="pre">A</span></code>, etc.).
The above example should be fixed as follows:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    *                    {}</span>
<span class="cm">    &quot;\aA\&quot;&#39;[]-\x5d\377&quot;  {}</span>
<span class="cm">    &#39;\aA&quot;\&#39;[]-\x5d\377&#39;  {}</span>
<span class="cm">    [\aA&quot;&#39;[\]\-\x5d\377] {}</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>More generally, re2c recognizes escapes in the following lexemes:</p>
<ul class="simple">
<li>double-quoted strings <code class="docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">...</span> <span class="pre">&quot;</span></code></li>
<li>single-quoted strings <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">...</span> <span class="pre">'</span></code></li>
<li>character classes <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">...</span> <span class="pre">]</span></code> and <code class="docutils literal notranslate"><span class="pre">[^</span> <span class="pre">...</span> <span class="pre">]</span></code></li>
</ul>
<p>The following escapes are recognized:</p>
<ul class="simple">
<li>Closing quotes (<code class="docutils literal notranslate"><span class="pre">\&quot;</span></code> for double-quoted strings, <code class="docutils literal notranslate"><span class="pre">\'</span></code> for single-quoted strings, and <code class="docutils literal notranslate"><span class="pre">\]</span></code> for character classes).</li>
<li>Dash <code class="docutils literal notranslate"><span class="pre">\-</span></code> in character classes.</li>
<li>Octal escapes: <code class="docutils literal notranslate"><span class="pre">\ooo</span></code>, where <code class="docutils literal notranslate"><span class="pre">o</span></code> is in range <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">-</span> <span class="pre">7]</span></code>
(the largest octal escape is <code class="docutils literal notranslate"><span class="pre">\377</span></code>, which equals <code class="docutils literal notranslate"><span class="pre">0xFF</span></code>).</li>
<li>Hexadecimal escapes: <code class="docutils literal notranslate"><span class="pre">\xhh</span></code>, <code class="docutils literal notranslate"><span class="pre">\Xhhhh</span></code>, <code class="docutils literal notranslate"><span class="pre">\uhhhh</span></code>, and <code class="docutils literal notranslate"><span class="pre">\Uhhhhhhhh</span></code>,
where <code class="docutils literal notranslate"><span class="pre">h</span></code> is in range <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">-</span> <span class="pre">9]</span></code>, <code class="docutils literal notranslate"><span class="pre">[a</span> <span class="pre">-</span> <span class="pre">f]</span></code>, or <code class="docutils literal notranslate"><span class="pre">[A</span> <span class="pre">-</span> <span class="pre">F]</span></code>.</li>
<li>Miscellaneous escapes: <code class="docutils literal notranslate"><span class="pre">\a</span></code>, <code class="docutils literal notranslate"><span class="pre">\b</span></code>, <code class="docutils literal notranslate"><span class="pre">\f</span></code>, <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">\r</span></code>, <code class="docutils literal notranslate"><span class="pre">\t</span></code>, <code class="docutils literal notranslate"><span class="pre">\v</span></code>, <code class="docutils literal notranslate"><span class="pre">\\</span></code>.</li>
</ul>
<p>Ill-formed octal and hexadecimal escapes are treated as errors.
An escape followed by a newline is also an error: multiline strings and character classes are not allowed.
Any other ill-formed escapes are ignored.</p>
</div>
<div class="section" id="wswapped-range">
<h3>[-Wswapped-range]<a class="headerlink" href="#wswapped-range" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">-Wswapped-range</span></code> warning is reported in cases when a character class contains
a range which lower bound is greater than the upper bound. For some strange
reason older versions of re2c did not consider this an error and silently
swapped range bounds. Consider the following example (swapped.re):</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    *     { return &quot;*&quot;; }</span>
<span class="cm">    [a-Z] { return &quot;is it what you wanted?&quot;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>Re2c interprets this code as <code class="docutils literal notranslate"><span class="pre">[Z-a]</span></code>, but generates a warning:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -Wswapped-range swapped.re -o swapped.c
swapped.re:3:5: warning: range lower bound (0x61) is greater than upper bound (0x5A), swapping [-Wswapped-range]
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">[-Werror-swapped-range]</span></code> to make it an error.</p>
</div>
<div class="section" id="wempty-character-class">
<h3>[-Wempty-character-class]<a class="headerlink" href="#wempty-character-class" title="Permalink to this headline">¶</a></h3>
<p>This warning is complementary to the
<code class="docutils literal notranslate"><span class="pre">--empty-class</span> <span class="pre">&lt;match-empty</span> <span class="pre">|</span> <span class="pre">match-none</span> <span class="pre">|</span> <span class="pre">error&gt;</span></code> option.
For bakward compatibility reasons the default is <code class="docutils literal notranslate"><span class="pre">match-empty</span></code>: empty
character class <code class="docutils literal notranslate"><span class="pre">[]</span></code> matches empty string (that is, it always matches without
consuming any input). This behaviour doesn’t make much sense, therefore re2c
provides a warning <code class="docutils literal notranslate"><span class="pre">-Wempty-character-class</span></code>.
Note that empty character class can be constructed in many ways, for example as
a result of range negation or the difference operator. The code below (empty.re)
demonstrates some of the possibilities:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    []                        { return 0; }</span>
<span class="cm">    [^\x00-\xFF]              { return 1; }</span>
<span class="cm">    [^] \ [^]                 { return 2; }</span>
<span class="cm">    [abc] \ (&quot;a&quot; | &quot;b&quot; | &quot;c&quot;) { return 3; }</span>
<span class="cm">    &quot;a&quot; \ [a-z]               { return 4; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>Re2c gives the following warnings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -Wempty-character-class empty.re -o empty.c
empty.re:2:4: warning: empty character class [-Wempty-character-class]
empty.re:3:4: warning: empty character class [-Wempty-character-class]
empty.re:4:4: warning: empty character class [-Wempty-character-class]
empty.re:5:4: warning: empty character class [-Wempty-character-class]
empty.re:6:4: warning: empty character class [-Wempty-character-class]
</pre></div>
</div>
</div>
<div class="section" id="wmatch-empty-string">
<h3>[-Wmatch-empty-string]<a class="headerlink" href="#wmatch-empty-string" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">[-Wmatch-empty-string]</span></code> warns when a rule is nullable (matches an empty
string). It was intended to prevent infinite looping in cases like the
<a class="reference download internal" href="../_downloads/hang.re" download=""><code class="xref download docutils literal notranslate"><span class="pre">[hang.re]</span></code></a>
example below. The program loops over its arguments (the outer <code class="docutils literal notranslate"><span class="pre">for</span></code> loop)
and tries to lex each argument (the inner <code class="docutils literal notranslate"><span class="pre">for</span></code> loop). The lexer stops when
all input has been consumed and it sees the terminating <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Arguments must
consist of lowercase letters only.</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">YYCURSOR</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">];;)</span> <span class="p">{</span>
        <span class="cm">/*!re2c</span>
<span class="cm">            re2c:define:YYCTYPE = char;</span>
<span class="cm">            re2c:yyfill:enable = 0;</span>
<span class="cm">            &quot;\x00&quot; { break; }</span>
<span class="cm">            [a-z]* { continue; }</span>
<span class="cm">        */</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;argv[%d]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>On well-formed input the program runs as expected. However, if one of the
arguments contains a symbol diffrerent from lowercase letter, the program hangs
forever:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ re2c -Wmatch-empty-string hang.re -o hang.c
hang.re:11:19: warning: rule matches empty string [-Wmatch-empty-string]
$ c++ -o hang hang.c
$
$ ./hang only lowercase letters
argv[1]: only
argv[2]: lowercase
argv[3]: letters
$
$ ./hang right ?
argv[1]: right
^C
</pre></div>
</div>
<p>Note that if we add default rule <code class="docutils literal notranslate"><span class="pre">*</span></code>, the lexer won’t hang anymore: it will
match the default rule instead of the nullable rule. The fix is easy: make the
rule non-nullable (say, <code class="docutils literal notranslate"><span class="pre">[a-z]+</span></code>) and add default rule <code class="docutils literal notranslate"><span class="pre">*</span></code>.</p>
<p>In some cases matching an empty string makes perfect sense: for example, it
might be used as a non-consuming default rule, or it might be used to lex an
optional lexeme (if the corresponding rule doesn’t match, the lexer jumps to
another block and resumes lexing at the same input position). All these cases
are valid, so if <code class="docutils literal notranslate"><span class="pre">[-Wmatch-empty-string]</span></code> becomes annoying, it can be silenced
with <code class="docutils literal notranslate"><span class="pre">[-Wno-match-empty-string]</span></code>.</p>
</div>
</div>
<div class="section" id="more-examples">
<h2>More examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_04.html">Parsing integers with multiple interrelated blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_05.html">Parsing integers with start conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_09.html">Parsing /etc/passwd with tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_14.html">Parsing options and arguments with tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_13.html">Parsing records and structs with tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_07.html">C++98 lexer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_10.html">Parsing URI (RFC-3986)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_11.html">Parsing HTTP message headers (RFC-7230)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_06.html">Parsing Braille patterns with multiple encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_15.html">Finding strings in binaries with generic API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_16.html">Faking sentinel characted with generic API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/example_17.html">Reading from std::ifstream with generic API</a></li>
</ul>
</div>
<p>All examples are written in C-90 and in C++98, so they should be portable.
Feel free to <a class="reference external" href="mailto:re2c-general&#37;&#52;&#48;lists&#46;sourceforge&#46;net">report bugs</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
      Last updated on Aug 05, 2019.
    </div>
  </body>
</html>